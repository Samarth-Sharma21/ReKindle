import{an as P,e as W,r as d,j as e,C as R,s as a,n as i,q as _,B as t,P as q,w as A,x as m}from"./index-C2jwSk0r.js";import{A as u}from"./ArrowBack-Cn1Uloaa.js";import{L}from"./LocationOn-CdZrmAFE.js";import{P as F}from"./People-BMTfjlb9.js";import{C as G,a as H}from"./CalendarToday-BHVXg7L9.js";import{E as O}from"./Edit-D5AypILh.js";import{D as T}from"./Delete-DRwgYOMt.js";import{S as U}from"./Share-M54VPnWW.js";import{A as Y}from"./AudioPlayer-DReQaWPa.js";import{C as x}from"./Container-CVIF3dFE.js";import{C as p}from"./Chip-ChcIFS1b.js";import"./Pause-kIRdPeQ4.js";const oe=()=>{const{id:n}=P(),f=W(),[r,j]=d.useState(null),[v,w]=d.useState(!0),[y,l]=d.useState("");d.useEffect(()=>{(async()=>{try{const{data:{user:s},error:B}=await m.auth.getUser();if(B||!s)throw new Error("User not authenticated");const{data:c,error:g}=await m.from("memories").select("*").eq("id",n).single();if(g)throw g;if(!c){l("Memory not found");return}if(c.user_id===s.id){j(c);return}const{data:b,error:M}=await m.from("family_members").select("patient_id").eq("id",s.id).single();if(M||!b){l("You do not have permission to view this memory");return}c.user_id===b.patient_id?j(c):l("You do not have permission to view this memory")}catch(s){console.error("Error fetching memory:",s.message),l("Error loading memory")}finally{w(!1)}})()},[n]);const h=()=>{f(-1)},C=()=>{console.log("Edit memory:",n)},E=async()=>{try{const{error:o}=await m.from("memories").delete().eq("id",n);if(o)throw o;f(-1)}catch(o){console.error("Error deleting memory:",o.message),l("Error deleting memory")}},I=()=>{console.log("Share memory:",n)},D=o=>{const s={year:"numeric",month:"long",day:"numeric"};return new Date(o).toLocaleDateString(void 0,s)},k=o=>{switch(o){case"polaroid":return{border:"15px solid white",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.1)",transform:"rotate(-2deg)",mb:2};case"sepia":return{filter:"sepia(100%)",border:"5px solid #d4b483",mb:2};case"vintage":return{filter:"grayscale(50%)",border:"8px solid #f5f5f5",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.15)",mb:2};default:return{mb:2}}},S=()=>{if(!r)return null;switch(r.type){case"photo":return e.jsx(t,{sx:{mb:4},children:e.jsx(H,{component:"img",image:r.content,alt:r.title,sx:{width:"100%",maxHeight:"500px",objectFit:"contain",borderRadius:2,...k(r.filter)}})});case"voice":return e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:3,mb:4,bgcolor:"background.paper",borderRadius:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Voice Recording"}),e.jsx(t,{sx:{width:"100%"},children:e.jsx(Y,{filePath:r.content,showControls:!0})})]});case"text":return e.jsx(t,{sx:{p:3,mb:4,bgcolor:"background.paper",borderRadius:2,border:"1px solid",borderColor:"divider",fontStyle:"italic",lineHeight:1.8},children:e.jsx(a,{variant:"body1",paragraph:!0,children:r.content})});default:return null}};return v?e.jsx(x,{maxWidth:"md",sx:{mt:4,mb:4,display:"flex",justifyContent:"center"},children:e.jsx(R,{})}):y?e.jsxs(x,{maxWidth:"md",sx:{mt:4,mb:4},children:[e.jsx(a,{color:"error",children:y}),e.jsx(i,{startIcon:e.jsx(u,{}),onClick:h,sx:{mt:2},children:"Go Back"})]}):r?e.jsx(x,{maxWidth:"md",sx:{mt:2,mb:4},children:e.jsxs(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},style:{width:"100%"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:4},children:[e.jsx(i,{startIcon:e.jsx(u,{}),onClick:h,sx:{mr:2},children:"Back"}),e.jsx(a,{variant:"h4",component:"h1",children:"Memory Details"})]}),e.jsxs(q,{elevation:2,sx:{p:3,borderRadius:3},children:[e.jsxs(t,{sx:{mb:3},children:[e.jsx(a,{variant:"h4",component:"h2",gutterBottom:!0,children:r.title}),e.jsxs(t,{sx:{display:"flex",flexWrap:"wrap",gap:2,mb:2},children:[e.jsx(p,{icon:e.jsx(G,{}),label:D(r.date),variant:"outlined"}),r.location&&e.jsx(p,{icon:e.jsx(L,{}),label:r.location,variant:"outlined"}),r.people&&r.people.length>0&&e.jsx(p,{icon:e.jsx(F,{}),label:`${r.people.length} ${r.people.length===1?"person":"people"}`,variant:"outlined"})]})]}),S(),r.description&&e.jsxs(t,{sx:{mb:4},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(a,{variant:"body1",paragraph:!0,children:r.description})]}),r.people&&r.people.length>0&&e.jsxs(t,{sx:{mb:4},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"People"}),e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:r.people.map((o,s)=>e.jsx(p,{label:o},s))})]}),e.jsx(A,{sx:{my:3}}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsx(i,{variant:"outlined",color:"error",startIcon:e.jsx(T,{}),onClick:E,children:"Delete"}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(i,{variant:"outlined",startIcon:e.jsx(U,{}),onClick:I,children:"Share"}),e.jsx(i,{variant:"contained",color:"primary",startIcon:e.jsx(O,{}),onClick:C,children:"Edit"})]})]})]})]})}):e.jsxs(x,{maxWidth:"md",sx:{mt:4,mb:4},children:[e.jsx(a,{children:"Memory not found"}),e.jsx(i,{startIcon:e.jsx(u,{}),onClick:h,sx:{mt:2},children:"Go Back"})]})};export{oe as default};
