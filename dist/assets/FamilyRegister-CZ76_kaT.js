import{u as F,k as L,r as d,j as e,B as c,m as P,d as C,l as f,P as _,L as N,g as p,I,N as z,h as H,s as g}from"./index-C_HSOms8.js";import{V as R,a as A}from"./VisibilityOff-DMRHpYR6.js";import{A as V}from"./ArrowBack-DsbyHIOv.js";import{P as T}from"./Phone-B2yuix-e.js";import{C as O}from"./Container-Bc-qhFrR.js";import{A as U}from"./Alert-BYILcwLX.js";import{T as s}from"./TextField-BkNW727p.js";import{I as h}from"./InputAdornment-Usg9kTa4.js";import{F as $}from"./FormControlLabel-C1zFav9H.js";import{C as G}from"./Checkbox-B3IJ982s.js";import"./useFormControl-BRv-t9n6.js";const se=()=>{const W=F(),{login:k}=L(),[y,r]=d.useState(!1),[a,S]=d.useState({name:"",mobile:"",email:"",password:"",confirmPassword:"",patientMobile:"",relationship:"",agreeTerms:!1}),[b,D]=d.useState(!1),[x,E]=d.useState(!1),[j,t]=d.useState(""),i=n=>{const{name:l,value:o,checked:m}=n.target;S({...a,[l]:l==="agreeTerms"?m:o})},w=n=>{n==="password"?D(!b):E(!x)},M=async n=>{if(n.preventDefault(),r(!0),t(""),!a.name||!a.mobile||!a.email||!a.password||!a.confirmPassword||!a.patientMobile||!a.relationship){t("Please fill in all fields"),r(!1);return}if(!a.agreeTerms){t("Please agree to the terms and conditions"),r(!1);return}if(a.password!==a.confirmPassword){t("Passwords do not match"),r(!1);return}if(a.password.length<6){t("Password must be at least 6 characters long"),r(!1);return}const l=/^[0-9]{10}$/;if(!l.test(a.mobile.replace(/[^0-9]/g,""))){t("Please enter a valid 10-digit Indian mobile number"),r(!1);return}if(!l.test(a.patientMobile.replace(/[^0-9]/g,""))){t("Please enter a valid 10-digit Indian mobile number for the patient"),r(!1);return}try{const{data:o,error:m}=await g.auth.signUp({email:a.email,password:a.password});if(m)throw m;const{data:u,error:q}=await g.from("patients").select("id, name").eq("mobile",a.patientMobile).single();if(q||!u)throw new Error("Patient not found. Please check the mobile number and try again.");const{data:J,error:v}=await g.from("family_members").insert([{id:o.user.id,name:a.name,mobile:a.mobile,email:a.email,relationship:a.relationship,patient_mobile:a.patientMobile,patient_id:u.id}]);if(v)throw v;const B={id:o.user.id,name:a.name,email:a.email,mobile:a.mobile,relationship:a.relationship,patient_id:u.id,patient_name:u.name,patient_mobile:a.patientMobile,type:"family"};k("family",B),W("/family/dashboard")}catch(o){console.error("Registration error:",o.message),t(o.message)}finally{r(!1)}};return e.jsx(c,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",bgcolor:"background.default",py:4},children:e.jsx(O,{maxWidth:"sm",children:e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx(C,{component:f,to:"/",startIcon:e.jsx(V,{}),sx:{mb:4},children:"Back to Home"}),e.jsxs(_,{elevation:3,sx:{p:4,borderRadius:2,bgcolor:"background.paper"},children:[e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[e.jsx(c,{sx:{mb:2},children:e.jsx(N,{size:"large"})}),e.jsx(p,{variant:"h5",gutterBottom:!0,sx:{fontWeight:500},children:"Create Family Account"}),e.jsx(p,{variant:"body1",color:"text.secondary",align:"center",sx:{mb:4,maxWidth:"450px",mx:"auto"},children:"Register to connect with your family member and access their memories."})]}),j&&e.jsx(U,{severity:"error",sx:{mb:3},children:j}),e.jsxs("form",{onSubmit:M,children:[e.jsx(s,{fullWidth:!0,label:"Full Name",name:"name",value:a.name,onChange:i,margin:"normal",variant:"outlined",required:!0,InputProps:{sx:{borderRadius:2}}}),e.jsx(s,{fullWidth:!0,label:"Mobile Number",name:"mobile",value:a.mobile,onChange:i,margin:"normal",variant:"outlined",required:!0,placeholder:"e.g. 9876543210",InputProps:{sx:{borderRadius:2},startAdornment:e.jsx(h,{position:"start",children:e.jsx(T,{color:"action"})})},helperText:"Enter a 10-digit Indian mobile number"}),e.jsx(s,{fullWidth:!0,label:"Email Address",name:"email",type:"email",value:a.email,onChange:i,margin:"normal",variant:"outlined",required:!0,InputProps:{sx:{borderRadius:2}}}),e.jsx(s,{fullWidth:!0,label:"Relationship to Patient",name:"relationship",value:a.relationship,onChange:i,placeholder:"e.g. Daughter, Son, Spouse",margin:"normal",variant:"outlined",required:!0,InputProps:{sx:{borderRadius:2}}}),e.jsx(s,{fullWidth:!0,label:"Patient's Mobile Number",name:"patientMobile",value:a.patientMobile,onChange:i,margin:"normal",variant:"outlined",required:!0,placeholder:"e.g. 9876543210",InputProps:{sx:{borderRadius:2},startAdornment:e.jsx(h,{position:"start",children:e.jsx(T,{color:"action"})})},helperText:"Enter the patient's 10-digit Indian mobile number"}),e.jsx(s,{fullWidth:!0,label:"Password",name:"password",type:b?"text":"password",value:a.password,onChange:i,margin:"normal",variant:"outlined",required:!0,InputProps:{sx:{borderRadius:2},endAdornment:e.jsx(h,{position:"end",children:e.jsx(I,{"aria-label":"toggle password visibility",onClick:()=>w("password"),edge:"end",children:b?e.jsx(R,{}):e.jsx(A,{})})})}}),e.jsx(s,{fullWidth:!0,label:"Confirm Password",name:"confirmPassword",type:x?"text":"password",value:a.confirmPassword,onChange:i,margin:"normal",variant:"outlined",required:!0,InputProps:{sx:{borderRadius:2},endAdornment:e.jsx(h,{position:"end",children:e.jsx(I,{"aria-label":"toggle password visibility",onClick:()=>w("confirm"),edge:"end",children:x?e.jsx(R,{}):e.jsx(A,{})})})},sx:{mb:2}}),e.jsx($,{control:e.jsx(G,{name:"agreeTerms",checked:a.agreeTerms,onChange:i,color:"primary"}),label:e.jsxs(p,{variant:"body2",children:["I agree to the"," ",e.jsx(f,{to:"/terms",style:{color:"inherit",fontWeight:"bold"},children:"Terms and Conditions"})]}),sx:{mb:3}}),e.jsx(C,{component:P.button,whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",fullWidth:!0,variant:"contained",color:"primary",size:"large",disabled:y,sx:{py:1.5,borderRadius:2,fontSize:"1.1rem",mb:2},children:y?e.jsx(z,{size:24,color:"inherit"}):"Register"})]}),e.jsx(H,{sx:{my:3}}),e.jsx(c,{sx:{textAlign:"center"},children:e.jsxs(p,{variant:"body2",color:"text.secondary",children:["Already have an account?"," ",e.jsx(f,{to:"/family/login",style:{color:"inherit",fontWeight:"bold"},children:"Log in here"})]})})]})]})})})};export{se as default};
