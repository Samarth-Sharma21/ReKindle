import{u as L,k as T,r as l,j as e,B as u,m as k,d as o,l as m,P as z,L as B,g as j,I as F,h as R,s as p}from"./index-7zbgi2qQ.js";import{V as q,a as V}from"./VisibilityOff-5Fd-1fTL.js";import{A as G}from"./ArrowBack-c1su4zvR.js";import{C as H}from"./Chatbot-D4yxucuF.js";import{C as O}from"./Container-DZq_lvjJ.js";import{A as M}from"./Alert-BRbQA1fK.js";import{T as w}from"./TextField-CCuzYXtS.js";import{I as N}from"./InputAdornment-DguS799i.js";import{G as x}from"./Grid-1SM4JlKV.js";import"./Close-Dp5OKbWP.js";import"./useFormControl-CcItWjiD.js";const ae=()=>{const v=L(),{login:I}=T(),[t,P]=l.useState({email:"",password:""}),[d,S]=l.useState(!1),[f,s]=l.useState(""),[h,i]=l.useState(!1),g=c=>{const{name:n,value:a}=c.target;P({...t,[n]:a})},A=()=>{S(!d)},C=async c=>{var n;if(c.preventDefault(),i(!0),!t.email||!t.password){s("Please fill in all fields"),i(!1);return}try{const{data:a,error:D}=await p.auth.signInWithPassword({email:t.email,password:t.password});if(D){s("Invalid email or password"),i(!1);return}const{data:r,error:W}=await p.from("family_members").select("*, patients:patient_id(*)").eq("id",a.user.id).single();if(W||!r){s("Error fetching family member data"),i(!1);return}console.log("Family member authenticated:",r);const{data:y,error:_}=await p.from("memories").select("*").eq("user_id",r.patient_id).order("created_at",{ascending:!1}).limit(5);let b=[];!_&&y&&(b=y);const E={id:a.user.id,name:r.name,email:r.email,mobile:r.mobile,relationship:r.relationship,patient_id:r.patient_id,patient_name:((n=r.patients)==null?void 0:n.name)||"Patient",patient_mobile:r.patient_mobile,memories:b,lastActive:new Date().toISOString()};I("family",E),v("/family/dashboard")}catch(a){console.error("Error logging in:",a.message),s("Authentication error. Please try again.")}finally{i(!1)}};return e.jsxs(u,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",bgcolor:"background.default",py:4},children:[e.jsx(H,{}),e.jsx(O,{maxWidth:"sm",children:e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx(o,{component:m,to:"/",startIcon:e.jsx(G,{}),sx:{mb:4},children:"Back to Home"}),e.jsxs(z,{elevation:3,sx:{p:4,borderRadius:2,bgcolor:"background.paper"},children:[e.jsxs(u,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[e.jsx(u,{sx:{mb:3},children:e.jsx(B,{size:"large"})}),e.jsx(j,{variant:"body1",color:"text.secondary",align:"center",sx:{mb:4,maxWidth:"400px",mx:"auto"},children:"Family Member Login - Connect with your loved one's memories"})]}),f&&e.jsx(M,{severity:"error",sx:{mb:3},children:f}),e.jsxs("form",{onSubmit:C,children:[e.jsx(w,{fullWidth:!0,label:"Email Address",name:"email",type:"email",value:t.email,onChange:g,margin:"normal",variant:"outlined",required:!0,InputProps:{sx:{borderRadius:2,fontSize:"1.1rem"}}}),e.jsx(w,{fullWidth:!0,label:"Password",name:"password",type:d?"text":"password",value:t.password,onChange:g,margin:"normal",variant:"outlined",required:!0,InputProps:{sx:{borderRadius:2,fontSize:"1.1rem"},endAdornment:e.jsx(N,{position:"end",children:e.jsx(F,{onClick:A,edge:"end","aria-label":"toggle password visibility",children:d?e.jsx(q,{}):e.jsx(V,{})})})}}),e.jsx(o,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",size:"large",disabled:h,sx:{mt:3,mb:2,py:1.5,fontSize:"1.1rem",fontWeight:600,textTransform:"none",borderRadius:2},children:h?"Logging in...":"Log In"}),e.jsxs(x,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(o,{component:m,to:"/forgot-password",fullWidth:!0,color:"primary",sx:{textTransform:"none"},children:"Forgot Password?"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(o,{component:m,to:"/family/register",fullWidth:!0,color:"primary",sx:{textTransform:"none"},children:"Create Account"})})]}),e.jsx(R,{sx:{my:3},children:e.jsx(j,{variant:"body2",color:"text.secondary",children:"or"})}),e.jsx(o,{component:m,to:"/patient/login",fullWidth:!0,variant:"outlined",color:"primary",size:"large",sx:{py:1.5,fontSize:"1.1rem",fontWeight:600,textTransform:"none",borderRadius:2},children:"Log In as Patient"})]})]})]})})]})};export{ae as default};
