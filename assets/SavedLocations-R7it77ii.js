import{d as J,j as e,e as ae,g as re,$ as ne,r as m,B as u,I as S,s as v,n as w,P as T,R as a,w as ie,x as M,ap as k}from"./index-roVfk5N6.js";import{D as le}from"./Delete-DUtDBw7F.js";import{E as ce}from"./Edit-t3U_gI9a.js";import{S as de}from"./Search-nkRdoDut.js";import{A as pe}from"./ArrowBack-CfGoCjZ_.js";import{L as z}from"./LocationOn-C-NGzLxA.js";import{H as me}from"./Home-xtG0fsCD.js";import{C as ue}from"./Container-DsuWhPWr.js";import{T as D,A as he}from"./TextField-CzVmShLZ.js";import{I as xe}from"./InputAdornment-CR4h-gNZ.js";import{D as U,a as V,b as G,c as _}from"./DialogTitle-DLOoItv0.js";import{S as ge}from"./Snackbar-I_TTq3u6.js";import"./useFormControl-He7PUmod.js";const fe=J(e.jsx("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7"})),q=J(e.jsx("path",{d:"M20 1v3h3v2h-3v3h-2V6h-3V4h3V1zm-8 12c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m2-9.75V7h3v3h2.92c.05.39.08.79.08 1.2 0 3.32-2.67 7.25-8 11.8-5.33-4.55-8-8.48-8-11.8C4 6.22 7.8 3 12 3c.68 0 1.35.08 2 .25"})),Ne=()=>{const K=ae(),s=re(),r=s.palette.mode==="dark",{isMobile:H}=ne(),[l,x]=m.useState([]),[Y,I]=m.useState(!0),[W,y]=m.useState([]);m.useEffect(()=>{(async()=>{try{I(!0);const{data:{user:t},error:n}=await M.auth.getUser();if(n||!t){const p=localStorage.getItem("savedLocations"),g=p?JSON.parse(p):[];x(g),y(g),I(!1);return}const{data:i,error:d}=await k.getLocations(t.id);if(d)throw d;if(i)x(i),y(i);else{const p=localStorage.getItem("savedLocations"),g=p?JSON.parse(p):[];x(g),y(g)}}catch(t){console.error("Error fetching locations:",t.message);const n=localStorage.getItem("savedLocations"),i=n?JSON.parse(n):[];x(i),y(i)}finally{I(!1)}})()},[]);const[c,b]=m.useState({name:"",address:"",notes:"",isHome:!1}),[Q,$]=m.useState(!1),[j,R]=m.useState(null),[f,X]=m.useState(""),[C,h]=m.useState({open:!1,message:"",severity:"success"}),[L,B]=m.useState({open:!1,index:null,locationName:""});m.useEffect(()=>{if(f){const o=l.filter(t=>t.name.toLowerCase().includes(f.toLowerCase())||t.address.toLowerCase().includes(f.toLowerCase())||t.notes&&t.notes.toLowerCase().includes(f.toLowerCase()));y(o)}else y(l)},[f,l]),m.useEffect(()=>{localStorage.setItem("savedLocations",JSON.stringify(l))},[l]);const A=(o=null)=>{o!==null?(b(l[o]),R(o)):(b({name:"",address:"",notes:""}),R(null)),$(!0)},E=()=>{$(!1)},F=o=>{const{name:t,value:n,checked:i,type:d}=o.target;b({...c,[t]:d==="checkbox"?i:n})},Z=async()=>{if(!c.name||!c.address){h({open:!0,message:"Name and address are required",severity:"error"});return}try{const{data:{user:o},error:t}=await M.auth.getUser();if(t||!o)throw new Error("User not authenticated");const{isHome:n,...i}=c;if(j!==null){const p=l[j].id;p&&await k.updateLocation(i,p);const g=[...l];g[j]=c,x(g),h({open:!0,message:"Location updated successfully",severity:"success"})}else{const{data:d,error:p}=await k.saveLocation(i,o.id);if(p)throw p;const g=(d==null?void 0:d[0])||{...c,id:Date.now().toString()};x([...l,g]),h({open:!0,message:"Location saved successfully",severity:"success"})}}catch(o){if(console.error("Error saving location:",o.message),j!==null){const t=[...l];t[j]=c,x(t)}else x([...l,{...c,id:Date.now().toString()}]);h({open:!0,message:"Location saved locally (offline mode)",severity:"info"})}E()},ee=o=>{B({open:!0,index:o,locationName:l[o].name})},N=()=>{B({...L,open:!1})},oe=async()=>{const o=L.index;try{const n=l[o].id;n&&await k.deleteLocation(n);const i=l.filter((d,p)=>p!==o);x(i),h({open:!0,message:"Location deleted",severity:"info"})}catch(t){console.error("Error deleting location:",t.message);const n=l.filter((i,d)=>d!==o);x(n),h({open:!0,message:"Location deleted (offline mode)",severity:"info"})}N()},O=o=>{if(h({open:!0,message:`Navigating to ${o.name}`,severity:"info"}),o.address){const t=encodeURIComponent(o.address);window.open(`https://www.google.com/maps/search/?api=1&query=${t}`,"_blank")}else o.lat&&o.lng&&window.open(`https://www.google.com/maps/dir/?api=1&destination=${o.lat},${o.lng}`,"_blank")},te=()=>{navigator.geolocation?(h({open:!0,message:"Getting your current location...",severity:"info"}),navigator.geolocation.getCurrentPosition(o=>{const t=o.coords.latitude,n=o.coords.longitude;fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${t},${n}&key=`).then(i=>i.json()).then(i=>{if(i.status==="OK"&&i.results.length>0){const d=i.results[0].formatted_address;b({...c,address:d,lat:t,lng:n})}else b({...c,address:`Latitude: ${t}, Longitude: ${n}`,lat:t,lng:n})}).catch(i=>{console.error("Error getting address:",i),b({...c,address:`Latitude: ${t}, Longitude: ${n}`,lat:t,lng:n})})},o=>{console.error("Error getting location:",o),h({open:!0,message:"Could not get your location. Please check permissions.",severity:"error"})})):h({open:!0,message:"Geolocation is not supported by this browser.",severity:"error"})},P=()=>{h({...C,open:!1})},se=()=>{K(-1)};return e.jsxs(u,{sx:{width:"100%",maxWidth:"100%",minHeight:"100vh",bgcolor:"background.default",color:"text.primary",pt:{xs:2,sm:3},pb:{xs:6,sm:8}},children:[e.jsxs(ue,{maxWidth:"lg",sx:{px:{xs:2,sm:3,md:4}},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:{xs:3,sm:4},flexWrap:"wrap",gap:1},children:[e.jsx(S,{onClick:se,edge:"start",sx:{mr:1},children:e.jsx(pe,{})}),e.jsxs(v,{variant:H?"h5":"h4",component:"h1",sx:{fontWeight:600,display:"flex",alignItems:"center",fontSize:{xs:"1.4rem",sm:"1.8rem",md:"2.2rem"}},children:[e.jsx(z,{sx:{mr:1,color:s.palette.primary.main}}),"Saved Locations"]}),e.jsx(u,{sx:{flexGrow:1}}),e.jsx(w,{variant:"contained",color:"primary",startIcon:e.jsx(q,{}),onClick:()=>A(),size:H?"small":"medium",sx:{borderRadius:1},children:"Add Location"})]}),e.jsx(T,{elevation:2,sx:{p:2,mb:4,borderRadius:2,display:"flex",alignItems:"center",flexDirection:{xs:"column",sm:"row"},gap:2},children:e.jsx(D,{fullWidth:!0,placeholder:"Search locations by name or address...",variant:"outlined",size:"small",value:f,onChange:o=>X(o.target.value),InputProps:{startAdornment:e.jsx(xe,{position:"start",children:e.jsx(de,{})})}})}),Y?e.jsx(u,{sx:{textAlign:"center",py:8},children:e.jsx(ve,{})}):W.length>0?e.jsx(u,{sx:{py:2,display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)",lg:"repeat(4, 1fr)"},gap:{xs:2,sm:3},width:"100%"},children:W.map((o,t)=>e.jsxs(T,{elevation:3,sx:{borderRadius:2,overflow:"hidden",position:"relative",height:"100%",display:"flex",flexDirection:"column",background:r?a(s.palette.background.paper,.15):s.palette.background.paper,border:"1px solid",borderColor:r?a("rgb(250, 167, 43)",.2):a(s.palette.divider,.5),transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:s.shadows[8],borderColor:r?a("rgb(248, 166, 43)",.4):a(s.palette.primary.main,.3)}},children:[e.jsxs(u,{onClick:()=>O(o),sx:{p:2,display:"flex",alignItems:"center",gap:1.5,borderBottom:"1px solid",borderColor:r?a(s.palette.divider,.2):s.palette.divider,background:o.isHome?r?a("rgb(252, 165, 35)",.15):a(s.palette.primary.light,.15):r?a("rgb(251, 165, 45)",.1):a(s.palette.secondary.light,.08),cursor:"pointer","&:hover":{background:o.isHome?r?a("#FF9800",.2):a(s.palette.primary.light,.25):r?a("rgb(255, 144, 34)",.15):a(s.palette.secondary.light,.15)}},children:[e.jsx(u,{sx:{borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",p:1,background:r?a(s.palette.common.white,.05):a(s.palette.common.black,.03),boxShadow:`0 0 0 2px ${o.isHome?r?a("#FF9800",.5):a(s.palette.primary.main,.4):r?a("#FF5722",.5):a(s.palette.secondary.main,.4)}`},children:o.isHome?e.jsx(me,{sx:{color:r?"#FFB74D":s.palette.primary.main,fontSize:28}}):e.jsx(z,{sx:{color:r?"#FF8A65":s.palette.secondary.main,fontSize:28}})}),e.jsx(v,{variant:"h6",sx:{fontWeight:600,color:r?"#FAFAFA":s.palette.text.primary,fontSize:{xs:"1rem",sm:"1.1rem"},flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o.name})]}),e.jsxs(u,{sx:{p:2,cursor:"pointer",flexGrow:1,display:"flex",flexDirection:"column"},onClick:()=>O(o),children:[e.jsx(v,{variant:"body1",sx:{color:r?"#E0E0E0":s.palette.text.secondary,mb:1,fontSize:"0.9rem",wordBreak:"break-word"},children:o.address}),o.notes&&e.jsx(v,{variant:"body2",sx:{color:r?a("#E0E0E0",.7):a(s.palette.text.secondary,.8),fontSize:"0.8rem",mt:"auto",pt:1,fontStyle:"italic"},children:o.notes})]}),e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",borderTop:"1px solid",borderColor:r?a(s.palette.divider,.2):s.palette.divider,bgcolor:r?a("#424242",.7):a(s.palette.background.default,.5),mt:"auto"},children:[e.jsx(S,{"aria-label":"Edit location",onClick:n=>{n.stopPropagation(),A(t)},sx:{flex:1,color:r?"#4FC3F7":s.palette.info.main,py:1.2,borderRadius:0,"&:hover":{bgcolor:r?a("#4FC3F7",.1):a(s.palette.info.main,.08)}},children:e.jsx(ce,{fontSize:"small"})}),e.jsx(ie,{orientation:"vertical",flexItem:!0}),e.jsx(S,{"aria-label":"Delete location",onClick:n=>{n.stopPropagation(),ee(t)},sx:{flex:1,color:r?"#EF9A9A":s.palette.error.main,py:1.2,borderRadius:0,"&:hover":{bgcolor:r?a("#EF9A9A",.1):a(s.palette.error.main,.08)}},children:e.jsx(le,{fontSize:"small"})})]})]},o.id||t))}):e.jsxs(T,{elevation:2,sx:{p:5,borderRadius:2,textAlign:"center",bgcolor:r?a(s.palette.background.paper,.4):s.palette.background.paper},children:[e.jsx(z,{sx:{fontSize:60,color:"text.secondary",opacity:.5,mb:2}}),e.jsx(v,{variant:"h6",gutterBottom:!0,children:"No locations saved yet"}),e.jsx(v,{variant:"body1",color:"text.secondary",paragraph:!0,children:f?"No locations match your search criteria":"Add your important places to easily find them later"}),e.jsx(w,{variant:"contained",color:"primary",startIcon:e.jsx(q,{}),onClick:()=>A(),sx:{mt:2},children:"Add First Location"})]})]}),e.jsxs(U,{open:Q,onClose:E,maxWidth:"sm",fullWidth:!0,children:[e.jsx(V,{children:j!==null?"Edit Location":"Add New Location"}),e.jsx(G,{children:e.jsxs(u,{sx:{mt:1,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(D,{fullWidth:!0,label:"Location Name",name:"name",value:c.name,onChange:F,required:!0,variant:"outlined",margin:"dense",placeholder:"Home, Work, etc."}),e.jsxs(u,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(D,{fullWidth:!0,label:"Address",name:"address",value:c.address,onChange:F,required:!0,variant:"outlined",margin:"dense",placeholder:"Enter full address",multiline:!0,rows:2}),e.jsx(S,{onClick:te,sx:{mt:1},children:e.jsx(fe,{})})]}),e.jsx(D,{fullWidth:!0,label:"Notes (optional)",name:"notes",value:c.notes||"",onChange:F,variant:"outlined",margin:"dense",placeholder:"Any additional details about this location",multiline:!0,rows:3})]})}),e.jsxs(_,{children:[e.jsx(w,{onClick:E,children:"Cancel"}),e.jsx(w,{onClick:Z,variant:"contained",color:"primary",children:"Save"})]})]}),e.jsxs(U,{open:L.open,onClose:N,children:[e.jsx(V,{children:"Confirm Deletion"}),e.jsx(G,{children:e.jsxs(v,{children:['Are you sure you want to delete "',L.locationName,'"? This action cannot be undone.']})}),e.jsxs(_,{children:[e.jsx(w,{onClick:N,children:"Cancel"}),e.jsx(w,{onClick:oe,color:"error",children:"Delete"})]})]}),e.jsx(ge,{open:C.open,autoHideDuration:6e3,onClose:P,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(he,{onClose:P,severity:C.severity,children:C.message})})]})},ve=()=>e.jsx(u,{sx:{display:"inline-block",width:40,height:40,border:"4px solid rgba(0, 0, 0, 0.1)",borderRadius:"50%",borderTopColor:"primary.main",animation:"spin 1s ease-in-out infinite","@keyframes spin":{to:{transform:"rotate(360deg)"}}}});export{Ne as default};
