import{u as V,r as d,m as D,j as e,C as E,al as l,P as b,t as a,F as u,B as o,T as n,a as c,aB as f,o as I,bd as A,b5 as k,a6 as L,ab as R,K as j,ad as M,g as P,bj as F,f as T,bk as U,bl as $}from"./vendor-BpQ4GIZC.js";import{u as _,s as S}from"./addMemory-C0-Amh-w.js";import{L as Y}from"./index-AR_LmOrU.js";const Q=()=>{const y=V(),{user:s}=_(),[x,W]=d.useState([]),[z,v]=d.useState(!0),[w,C]=d.useState(null),t=D(),i=t.palette.mode==="dark",[p,B]=d.useState({name:(s==null?void 0:s.name)||"Family Member",email:(s==null?void 0:s.email)||"family@example.com",patientName:"Loading...",relation:(s==null?void 0:s.relation)||"Caretaker",lastActive:(s==null?void 0:s.lastActive)||"2 days ago",recentActivities:[{id:1,type:"memory_added",title:"Added a new photo",date:"2 hours ago"},{id:2,type:"routine_completed",title:"Completed morning routine",date:"Yesterday"},{id:3,type:"event_scheduled",title:"Doctor appointment scheduled",date:"3 days ago"}],...s}),[G,O]=d.useState(null);return d.useEffect(()=>{(async()=>{v(!0),C(null);try{const{data:{user:m},error:H}=await S.auth.getUser();if(H||!m)throw new Error("User not authenticated");const Z="123456",{data:g,error:h}=await S.from("memories").select("*").order("date",{ascending:!1});if(h)throw console.error("Memories fetch error:",h==null?void 0:h.message),h;console.log("Memories fetched:",(g==null?void 0:g.length)||0),W(g||[]),B(N=>({...N,patientName:"Patient",lastActive:"recently"}))}catch(m){console.error("Error in fetchMemories:",m.message),C(m.message)}finally{v(!1)}})()},[]),d.useEffect(()=>{console.log("Current memories state:",x)},[x]),e.jsx(E,{maxWidth:"lg",sx:{py:4},children:e.jsxs(l,{container:!0,spacing:4,children:[e.jsx(l,{item:!0,xs:12,children:e.jsxs(b,{elevation:2,component:u.div,initial:{y:-20,opacity:0},animate:{y:0,opacity:1},sx:{p:{xs:3,md:4},borderRadius:3,background:i?`linear-gradient(90deg, ${a(t.palette.primary.dark,.7)} 0%, ${a(t.palette.primary.main,.5)} 100%)`:`linear-gradient(90deg, ${t.palette.primary.main} 0%, ${t.palette.primary.dark} 100%)`,color:"#fff",position:"relative",overflow:"hidden",boxShadow:i?"0 10px 30px rgba(0, 0, 0, 0.3)":"0 10px 30px rgba(0, 0, 0, 0.15)"},children:[e.jsx(o,{sx:{position:"absolute",top:-100,right:-100,width:300,height:300,borderRadius:"50%",background:"rgba(255, 255, 255, 0.1)",zIndex:0}}),e.jsx(o,{sx:{position:"absolute",bottom:-80,left:-80,width:200,height:200,borderRadius:"50%",background:"rgba(255, 255, 255, 0.05)",zIndex:0}}),e.jsxs(l,{container:!0,spacing:3,alignItems:"center",sx:{position:"relative",zIndex:1},children:[e.jsxs(l,{item:!0,xs:12,md:8,children:[e.jsxs(n,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700},children:["Welcome back, ",p.name]}),e.jsxs(n,{variant:"subtitle1",sx:{mb:3,opacity:.9,fontSize:"1.1rem"},children:["You're managing memories for ",p.patientName,". Last activity was ",p.lastActive,"."]}),e.jsxs(o,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(c,{variant:"contained",startIcon:e.jsx(f,{}),onClick:()=>y("/add-memory"),sx:{bgcolor:"white",color:t.palette.primary.main,fontWeight:600,"&:hover":{bgcolor:"rgba(255, 255, 255, 0.9)"},px:3,py:1,borderRadius:2},children:"Add Memory"}),e.jsx(c,{variant:"outlined",color:"inherit",startIcon:e.jsx(A,{}),component:I,to:"/family/dashboard/timeline",sx:{borderColor:"rgba(255, 255, 255, 0.5)",fontWeight:600,"&:hover":{borderColor:"white",bgcolor:"rgba(255, 255, 255, 0.1)"},px:3,py:1,borderRadius:2},children:"View Timeline"})]})]}),e.jsx(l,{item:!0,xs:12,md:4,children:e.jsx(o,{sx:{display:"flex",justifyContent:{xs:"center",md:"flex-end"},alignItems:"center",mt:{xs:3,md:0},transform:"scale(1.1)",transformOrigin:"right center"},children:e.jsx(Y,{size:"large",withLink:!1})})})]})]})}),e.jsx(l,{item:!0,xs:12,md:8,children:e.jsxs(b,{elevation:2,component:u.div,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},sx:{p:3,borderRadius:3,height:"100%",transition:"transform 0.3s ease",bgcolor:i?a(t.palette.background.paper,.7):t.palette.background.paper,"&:hover":{transform:"translateY(-5px)",boxShadow:i?"0 10px 30px rgba(0,0,0,0.3)":"0 10px 30px rgba(0,0,0,0.1)"}},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(n,{variant:"h5",component:"h2",sx:{fontWeight:600},children:"Recent Memories"}),e.jsx(c,{endIcon:e.jsx(k,{}),component:I,to:"/family/dashboard/timeline",sx:{borderRadius:2,color:i?t.palette.primary.light:t.palette.primary.main},children:"View All"})]}),e.jsx(l,{container:!0,spacing:3,children:z?e.jsx(l,{item:!0,xs:12,children:e.jsx(o,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(L,{color:"primary"})})}):w?e.jsx(l,{item:!0,xs:12,children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",p:4,height:"100%",minHeight:"200px"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,mb:1,color:"error.main"},children:"Error loading memories"}),e.jsx(n,{variant:"body1",color:"text.secondary",sx:{mb:3},children:w}),e.jsx(c,{variant:"contained",color:"primary",onClick:()=>window.location.reload(),sx:{py:1.5,px:3,borderRadius:2},children:"Retry"})]})}):x&&x.length>0?x.slice(0,3).map(r=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(R,{component:u.div,whileHover:{y:-10,boxShadow:i?"0 10px 20px rgba(255,138,0,0.2)":"0 10px 20px rgba(0,0,0,0.1)",transition:{duration:.3}},sx:{height:"100%",borderRadius:2,overflow:"hidden",cursor:"pointer",transition:"all 0.3s ease",bgcolor:i?a(t.palette.background.paper,.6):t.palette.background.paper,boxShadow:i?"0 4px 10px rgba(0,0,0,0.2)":"0 4px 10px rgba(0,0,0,0.1)",border:i?`1px solid ${a(t.palette.primary.main,.2)}`:"none"},onClick:()=>y(`/memory/${r.id}`),children:[r.type==="photo"&&r.content&&e.jsx(o,{sx:{height:140,overflow:"hidden"},children:e.jsx("img",{src:r.content,alt:r.title||"Memory photo",style:{width:"100%",height:"100%",objectFit:"cover"}})}),r.type==="text"&&e.jsx(o,{sx:{height:140,bgcolor:i?a("#9c27b0",.15):a("#9c27b0",.1),display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{p:2,fontStyle:"italic"},children:['"',r.content?r.content.substring(0,100)+"...":"No content",'"']})}),r.type==="voice"&&e.jsxs(o,{sx:{height:140,bgcolor:i?a("#2196f3",.15):a("#2196f3",.1),display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[e.jsx(j,{sx:{bgcolor:a("#2196f3",.2),"&:hover":{bgcolor:a("#2196f3",.3)}},children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2Z"}),e.jsx("path",{fill:"currentColor",d:"M19,10C19,15 15.36,19 12,19C8.64,19 5,15 5,10H7A5,5 0 0,0 12,15A5,5 0 0,0 17,10H19Z"}),e.jsx("path",{fill:"currentColor",d:"M12,19V22H10V19H12M12,19V22H14V19H12"})]})}),e.jsx(n,{variant:"body2",sx:{mt:1},children:"Voice Recording"})]}),(!r.type||!r.type==="photo"&&!r.type==="text"&&!r.type==="voice")&&e.jsx(o,{sx:{height:140,bgcolor:i?a(t.palette.primary.main,.15):a(t.palette.primary.main,.1),display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(n,{variant:"body2",color:"text.secondary",sx:{p:2},children:"Memory"})}),e.jsxs(M,{children:[e.jsx(n,{variant:"h6",component:"div",gutterBottom:!0,noWrap:!0,children:r.title||"Untitled Memory"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:1},children:r.date?new Date(r.date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"No date"}),e.jsx(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:r.location&&e.jsx(P,{size:"small",label:r.location,sx:{borderRadius:1,bgcolor:i?a(t.palette.primary.main,.1):void 0}})})]})]})},r.id)):e.jsx(l,{item:!0,xs:12,children:e.jsxs(o,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",p:4,height:"100%",minHeight:"200px"},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600,mb:1},children:"No memories found yet"}),e.jsxs(n,{variant:"body1",color:"text.secondary",sx:{mb:3},children:[p.patientName," doesn't have any memories yet. Add their first memory!"]}),e.jsx(c,{variant:"contained",startIcon:e.jsx(f,{}),color:"primary",onClick:()=>y("/add-memory"),sx:{py:1.5,px:3,borderRadius:2},children:"Add First Memory"})]})})})]})}),e.jsx(l,{item:!0,xs:12,md:4,children:e.jsxs(b,{elevation:2,component:u.div,initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2},sx:{p:3,borderRadius:3,height:"100%",transition:"transform 0.3s ease",bgcolor:i?a(t.palette.background.paper,.7):t.palette.background.paper,"&:hover":{transform:"translateY(-5px)",boxShadow:i?"0 10px 30px rgba(0,0,0,0.3)":"0 10px 30px rgba(0,0,0,0.1)"}},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(n,{variant:"h5",component:"h2",sx:{fontWeight:600},children:"Recent Activity"}),e.jsx(j,{size:"small",sx:{bgcolor:i?a(t.palette.primary.main,.1):a("#f5f5f5",.8),"&:hover":{bgcolor:i?a(t.palette.primary.main,.2):a("#f5f5f5",1)},color:i?t.palette.primary.light:void 0},children:e.jsx(F,{fontSize:"small"})})]}),e.jsx(T,{spacing:2,children:p.recentActivities.map(r=>e.jsx(R,{variant:"outlined",sx:{borderRadius:2,boxShadow:"none",bgcolor:i?a(t.palette.background.paper,.4):t.palette.background.paper,borderColor:i?a(t.palette.primary.main,.15):t.palette.divider,"&:hover":{borderColor:t.palette.primary.main,bgcolor:i?a(t.palette.primary.main,.05):a("#f5f5f5",.5)}},children:e.jsx(M,{sx:{p:2,"&:last-child":{pb:2}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"flex-start",gap:1.5},children:[e.jsx(o,{sx:{width:40,height:40,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:i?a(t.palette.primary.main,.1):a("#f5f5f5",.8),flexShrink:0},children:r.type==="memory_added"?e.jsx(f,{color:"primary"}):r.type==="routine_completed"?e.jsx(U,{color:"success"}):e.jsx(A,{color:"warning"})}),e.jsxs(o,{sx:{flexGrow:1},children:[e.jsx(n,{variant:"body2",gutterBottom:!0,fontWeight:500,children:r.title}),e.jsx(n,{variant:"caption",color:"text.secondary",children:r.date})]}),e.jsx(j,{size:"small",children:e.jsx($,{fontSize:"small"})})]})})},r.id))}),e.jsx(o,{sx:{mt:3,display:"flex",justifyContent:"center"},children:e.jsx(c,{variant:"outlined",endIcon:e.jsx(k,{}),sx:{borderRadius:2,color:i?t.palette.primary.light:void 0,borderColor:i?a(t.palette.primary.main,.3):void 0},children:"View All Activity"})})]})})]})})};export{Q as default};
