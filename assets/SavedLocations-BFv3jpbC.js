import{y as V,z as _,r as p,C as Y,j as e,J as F,K as H,N as K,d as T,e as Q,g as X,v as Z,q as ee,B as te,I as b,s as y,P as z,a2 as D,n as C,o as oe,x as P,ax as w}from"./index-CXEbI5Qv.js";import{D as se,a as ae,b as re,M as ne,c as ie}from"./MyLocation-DUgsZ4ng.js";import{D as ce}from"./Delete-BHD9k2-q.js";import{E as le}from"./Edit-Dt1XiTsm.js";import{A as de}from"./ArrowBack-EAnCmUyy.js";import{C as ue}from"./Container-Cq2we_GA.js";import{S as pe}from"./Snackbar-DNVNLGFv.js";import{A as me}from"./Alert-Db70WmmL.js";import{G as d}from"./Grid-DNk133Lp.js";import{T as S}from"./TextField-DdE3KPGU.js";import{I as B}from"./InputAdornment-DrWSyTS7.js";import{C as he,a as xe}from"./CardContent-CLYU36tH.js";import"./useFormControl-LDH5lfHo.js";function ge(m){return V("MuiCardActions",m)}_("MuiCardActions",["root","spacing"]);const fe=m=>{const{classes:n,disableSpacing:v}=m;return K({root:["root",!v&&"spacing"]},ge,n)},ve=F("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(m,n)=>{const{ownerState:v}=m;return[n.root,!v.disableSpacing&&n.spacing]}})({display:"flex",alignItems:"center",padding:8,variants:[{props:{disableSpacing:!1},style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),je=p.forwardRef(function(n,v){const x=Y({props:n,name:"MuiCardActions"}),{disableSpacing:i=!1,className:c,...r}=x,h={...x,disableSpacing:i},I=fe(h);return e.jsx(ve,{className:H(I.root,c),ownerState:h,ref:v,...r})}),E=T(e.jsx("path",{d:"M20 1v3h3v2h-3v3h-2V6h-3V4h3V1zm-8 12c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m2-9.75V7h3v3h2.92c.05.39.08.79.08 1.2 0 3.32-2.67 7.25-8 11.8-5.33-4.55-8-8.48-8-11.8C4 6.22 7.8 3 12 3c.68 0 1.35.08 2 .25"})),ye=T(e.jsx("path",{d:"M12 2 4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"})),Ce=T(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"})),We=()=>{const m=Q(),n=X(),{user:v}=Z(),x=n.palette.mode==="dark",[i,c]=p.useState([]);p.useEffect(()=>{(async()=>{try{const{data:{user:o},error:s}=await P.auth.getUser();if(s||!o){const f=localStorage.getItem("savedLocations");c(f?JSON.parse(f):[]);return}const{data:a,error:l}=await w.getLocations(o.id);if(l)throw l;if(a)c(a);else{const f=localStorage.getItem("savedLocations");c(f?JSON.parse(f):[])}}catch(o){console.error("Error fetching locations:",o.message);const s=localStorage.getItem("savedLocations");c(s?JSON.parse(s):[])}})()},[]);const[r,h]=p.useState({name:"",address:"",notes:""}),[I,R]=p.useState(!1),[g,U]=p.useState(null),[j,O]=p.useState(""),[L,u]=p.useState({open:!1,message:"",severity:"success"});p.useEffect(()=>{localStorage.setItem("savedLocations",JSON.stringify(i))},[i]);const A=(t=null)=>{t!==null?(h(i[t]),U(t)):(h({name:"",address:"",notes:""}),U(null)),R(!0)},k=()=>{R(!1)},N=t=>{const{name:o,value:s}=t.target;h({...r,[o]:s})},$=async()=>{if(!r.name||!r.address){u({open:!0,message:"Name and address are required",severity:"error"});return}try{const{data:{user:t},error:o}=await P.auth.getUser();if(o||!t)throw new Error("User not authenticated");if(g!==null){const a=i[g].id;a&&await w.updateLocation(r,a);const l=[...i];l[g]=r,c(l),u({open:!0,message:"Location updated successfully",severity:"success"})}else{const{data:s,error:a}=await w.saveLocation(r,t.id);if(a)throw a;const l=(s==null?void 0:s[0])||{...r,id:Date.now().toString()};c([...i,l]),u({open:!0,message:"Location saved successfully",severity:"success"})}}catch(t){if(console.error("Error saving location:",t.message),g!==null){const o=[...i];o[g]=r,c(o)}else c([...i,{...r,id:Date.now().toString()}]);u({open:!0,message:"Location saved locally (offline mode)",severity:"info"})}k()},q=async t=>{try{const s=i[t].id;s&&await w.deleteLocation(s);const a=i.filter((l,f)=>f!==t);c(a),u({open:!0,message:"Location deleted",severity:"info"})}catch(o){console.error("Error deleting location:",o.message);const s=i.filter((a,l)=>l!==t);c(s),u({open:!0,message:"Location deleted locally",severity:"info"})}},G=t=>{const o=encodeURIComponent(t);window.open(`https://www.google.com/maps/search/?api=1&query=${o}`,"_blank")},J=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const{latitude:o,longitude:s}=t.coords;fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${o}&lon=${s}`).then(a=>a.json()).then(a=>{const l=a.display_name||`${o}, ${s}`;h({...r,address:l})}).catch(a=>{console.error("Error getting address:",a),h({...r,address:`${o}, ${s}`})})},t=>{console.error("Error getting location:",t),u({open:!0,message:"Unable to get your current location",severity:"error"})}):u({open:!0,message:"Geolocation is not supported by your browser",severity:"error"})},W=()=>{u({...L,open:!1})},M=i.filter(t=>t.name.toLowerCase().includes(j.toLowerCase())||t.address.toLowerCase().includes(j.toLowerCase())||t.notes.toLowerCase().includes(j.toLowerCase()));return e.jsx(ue,{maxWidth:"lg",sx:{py:4},children:e.jsxs(ee.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsxs(te,{sx:{display:"flex",alignItems:"center",mb:4},children:[e.jsx(b,{onClick:()=>m(-1),sx:{mr:2},color:"primary",children:e.jsx(de,{})}),e.jsx(y,{variant:"h4",component:"h1",sx:{fontWeight:600},children:"Saved Locations"})]}),e.jsx(pe,{open:L.open,autoHideDuration:5e3,onClose:W,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(me,{onClose:W,severity:L.severity,sx:{width:"100%"},children:L.message})}),e.jsx(z,{elevation:2,sx:{p:3,mb:4,borderRadius:3,background:x?D(n.palette.background.paper,.6):n.palette.background.paper},children:e.jsxs(d,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(d,{item:!0,xs:12,md:8,children:e.jsx(S,{fullWidth:!0,placeholder:"Search locations...",value:j,onChange:t=>O(t.target.value),InputProps:{startAdornment:e.jsx(B,{position:"start",children:e.jsx(Ce,{color:"primary"})})},variant:"outlined",sx:{bgcolor:"background.paper",borderRadius:2}})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsx(C,{fullWidth:!0,variant:"contained",color:"primary",startIcon:e.jsx(E,{}),onClick:()=>A(),sx:{py:1.5,borderRadius:2,textTransform:"none",fontWeight:600,boxShadow:"0 4px 10px rgba(0, 0, 0, 0.1)","&:hover":{transform:"translateY(-2px)",boxShadow:"0 6px 15px rgba(0, 0, 0, 0.15)"},transition:"all 0.3s ease"},children:"Add New Location"})})]})}),e.jsx(d,{container:!0,spacing:3,children:M.length>0?M.map((t,o)=>e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs(he,{elevation:2,sx:{borderRadius:3,height:"100%",display:"flex",flexDirection:"column",transition:"all 0.3s ease","&:hover":{transform:"translateY(-5px)",boxShadow:"0 8px 20px rgba(0, 0, 0, 0.15)"},bgcolor:x?D(n.palette.background.paper,.6):n.palette.background.paper},children:[e.jsxs(xe,{sx:{flexGrow:1},children:[e.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontWeight:600},children:t.name}),e.jsx(y,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:t.address}),t.notes&&e.jsx(y,{variant:"body2",color:"text.secondary",sx:{mt:1},children:t.notes})]}),e.jsxs(je,{sx:{p:2,pt:0},children:[e.jsx(C,{size:"small",startIcon:e.jsx(ye,{}),onClick:()=>G(t.address),color:"primary",variant:"contained",sx:{mr:1,borderRadius:2,textTransform:"none"},children:"Navigate"}),e.jsx(b,{size:"small",onClick:()=>A(o),color:"primary",children:e.jsx(le,{})}),e.jsx(b,{size:"small",onClick:()=>q(o),color:"error",children:e.jsx(ce,{})})]})]})},o)):e.jsx(d,{item:!0,xs:12,children:e.jsxs(z,{elevation:1,sx:{p:4,textAlign:"center",borderRadius:3,bgcolor:x?D(n.palette.background.paper,.6):n.palette.background.paper},children:[e.jsx(y,{variant:"h6",color:"text.secondary",children:j?"No locations match your search":"No saved locations yet"}),e.jsx(C,{variant:"contained",color:"primary",startIcon:e.jsx(E,{}),onClick:()=>A(),sx:{mt:2,borderRadius:2,textTransform:"none"},children:"Add Your First Location"})]})})}),e.jsxs(se,{open:I,onClose:k,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,p:1}},children:[e.jsx(ae,{sx:{fontWeight:600},children:g!==null?"Edit Location":"Add New Location"}),e.jsx(re,{children:e.jsxs(d,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:"Location Name",name:"name",value:r.name,onChange:N,required:!0,variant:"outlined"})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:"Address",name:"address",value:r.address,onChange:N,required:!0,variant:"outlined",InputProps:{endAdornment:e.jsx(B,{position:"end",children:e.jsx(oe,{title:"Use current location",children:e.jsx(b,{onClick:J,edge:"end",children:e.jsx(ne,{})})})})}})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(S,{fullWidth:!0,label:"Notes (optional)",name:"notes",value:r.notes,onChange:N,multiline:!0,rows:3,variant:"outlined"})})]})}),e.jsxs(ie,{sx:{px:3,pb:3},children:[e.jsx(C,{onClick:k,color:"inherit",children:"Cancel"}),e.jsx(C,{onClick:$,variant:"contained",color:"primary",startIcon:e.jsx(E,{}),sx:{borderRadius:2,textTransform:"none"},children:g!==null?"Update Location":"Save Location"})]})]})]})})};export{We as default};
