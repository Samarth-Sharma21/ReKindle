import{d as J,j as e,e as ae,g as re,k as ne,r as p,B as m,I as k,s as f,n as j,P as H,_ as a,w as ie,x as M,av as D}from"./index-BmLVi8vg.js";import{D as le}from"./Delete-C-JMUuhf.js";import{E as ce}from"./Edit-CqOAxFTu.js";import{S as de}from"./Search-4fzQX_90.js";import{A as me}from"./ArrowBack-BAfnpC9L.js";import{L as T}from"./LocationOn-Tjx6elGm.js";import{H as pe}from"./Home-Bvsor7Mt.js";import{C as ue}from"./Container-Bvb4e2sG.js";import{T as I}from"./TextField-BSr3M5TF.js";import{I as he}from"./InputAdornment-BIraHNGR.js";import{D as U,a as V,b as _,c as G}from"./DialogTitle-BA7xkFFj.js";import{S as xe}from"./Snackbar-DxAnmTar.js";import{A as ge}from"./Alert-DHf0O5zk.js";import"./useFormControl-c-FtK5bv.js";const fe=J(e.jsx("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7"})),q=J(e.jsx("path",{d:"M20 1v3h3v2h-3v3h-2V6h-3V4h3V1zm-8 12c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m2-9.75V7h3v3h2.92c.05.39.08.79.08 1.2 0 3.32-2.67 7.25-8 11.8-5.33-4.55-8-8.48-8-11.8C4 6.22 7.8 3 12 3c.68 0 1.35.08 2 .25"})),He=()=>{const K=ae(),t=re(),i=t.palette.mode==="dark",z=ne(t.breakpoints.down("sm")),[c,h]=p.useState([]),[Q,A]=p.useState(!0),[W,y]=p.useState([]);p.useEffect(()=>{(async()=>{try{A(!0);const{data:{user:s},error:r}=await M.auth.getUser();if(r||!s){const g=localStorage.getItem("savedLocations"),w=g?JSON.parse(g):[];h(w),y(w),A(!1);return}const{data:n,error:d}=await D.getLocations(s.id);if(d)throw d;if(n)h(n),y(n);else{const g=localStorage.getItem("savedLocations"),w=g?JSON.parse(g):[];h(w),y(w)}}catch(s){console.error("Error fetching locations:",s.message);const r=localStorage.getItem("savedLocations"),n=r?JSON.parse(r):[];h(n),y(n)}finally{A(!1)}})()},[]);const[l,v]=p.useState({name:"",address:"",notes:"",isHome:!1}),[Y,$]=p.useState(!1),[b,B]=p.useState(null),[x,X]=p.useState(""),[C,u]=p.useState({open:!1,message:"",severity:"success"}),[L,O]=p.useState({open:!1,index:null,locationName:""});p.useEffect(()=>{if(x){const o=c.filter(s=>s.name.toLowerCase().includes(x.toLowerCase())||s.address.toLowerCase().includes(x.toLowerCase())||s.notes&&s.notes.toLowerCase().includes(x.toLowerCase()));y(o)}else y(c)},[x,c]),p.useEffect(()=>{localStorage.setItem("savedLocations",JSON.stringify(c))},[c]);const E=(o=null)=>{o!==null?(v(c[o]),B(o)):(v({name:"",address:"",notes:"",isHome:!1}),B(null)),$(!0)},F=()=>{$(!1)},S=o=>{const{name:s,value:r,checked:n,type:d}=o.target;v({...l,[s]:d==="checkbox"?n:r})},Z=async()=>{if(!l.name||!l.address){u({open:!0,message:"Name and address are required",severity:"error"});return}try{const{data:{user:o},error:s}=await M.auth.getUser();if(s||!o)throw new Error("User not authenticated");if(b!==null){const n=c[b].id;n&&await D.updateLocation(l,n);const d=[...c];d[b]=l,h(d),u({open:!0,message:"Location updated successfully",severity:"success"})}else{const{data:r,error:n}=await D.saveLocation(l,o.id);if(n)throw n;const d=(r==null?void 0:r[0])||{...l,id:Date.now().toString()};h([...c,d]),u({open:!0,message:"Location saved successfully",severity:"success"})}}catch(o){if(console.error("Error saving location:",o.message),b!==null){const s=[...c];s[b]=l,h(s)}else h([...c,{...l,id:Date.now().toString()}]);u({open:!0,message:"Location saved locally (offline mode)",severity:"info"})}F()},ee=o=>{O({open:!0,index:o,locationName:c[o].name})},N=()=>{O({...L,open:!1})},oe=async()=>{const o=L.index;try{const r=c[o].id;r&&await D.deleteLocation(r);const n=c.filter((d,g)=>g!==o);h(n),u({open:!0,message:"Location deleted",severity:"info"})}catch(s){console.error("Error deleting location:",s.message);const r=c.filter((n,d)=>d!==o);h(r),u({open:!0,message:"Location deleted (offline mode)",severity:"info"})}N()},R=o=>{if(u({open:!0,message:`Navigating to ${o.name}`,severity:"info"}),o.address){const s=encodeURIComponent(o.address);window.open(`https://www.google.com/maps/search/?api=1&query=${s}`,"_blank")}else o.lat&&o.lng&&window.open(`https://www.google.com/maps/dir/?api=1&destination=${o.lat},${o.lng}`,"_blank")},te=()=>{navigator.geolocation?(u({open:!0,message:"Getting your current location...",severity:"info"}),navigator.geolocation.getCurrentPosition(o=>{const s=o.coords.latitude,r=o.coords.longitude;fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${s},${r}&key=`).then(n=>n.json()).then(n=>{if(n.status==="OK"&&n.results.length>0){const d=n.results[0].formatted_address;v({...l,address:d,lat:s,lng:r})}else v({...l,address:`Latitude: ${s}, Longitude: ${r}`,lat:s,lng:r})}).catch(n=>{console.error("Error getting address:",n),v({...l,address:`Latitude: ${s}, Longitude: ${r}`,lat:s,lng:r})})},o=>{console.error("Error getting location:",o),u({open:!0,message:"Could not get your location. Please check permissions.",severity:"error"})})):u({open:!0,message:"Geolocation is not supported by this browser.",severity:"error"})},P=()=>{u({...C,open:!1})},se=()=>{K(-1)};return e.jsxs(m,{sx:{width:"100%",maxWidth:"100%",minHeight:"100vh",bgcolor:"background.default",color:"text.primary",pt:{xs:2,sm:3},pb:{xs:6,sm:8}},children:[e.jsxs(ue,{maxWidth:"lg",sx:{px:{xs:2,sm:3,md:4}},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",mb:{xs:3,sm:4},flexWrap:"wrap",gap:1},children:[e.jsx(k,{onClick:se,edge:"start",sx:{mr:1},children:e.jsx(me,{})}),e.jsxs(f,{variant:z?"h5":"h4",component:"h1",sx:{fontWeight:600,display:"flex",alignItems:"center",fontSize:{xs:"1.4rem",sm:"1.8rem",md:"2.2rem"}},children:[e.jsx(T,{sx:{mr:1,color:t.palette.primary.main}}),"Saved Locations"]}),e.jsx(m,{sx:{flexGrow:1}}),e.jsx(j,{variant:"contained",color:"primary",startIcon:e.jsx(q,{}),onClick:()=>E(),size:z?"small":"medium",sx:{borderRadius:1},children:"Add Location"})]}),e.jsx(H,{elevation:2,sx:{p:2,mb:4,borderRadius:2,display:"flex",alignItems:"center",flexDirection:{xs:"column",sm:"row"},gap:2},children:e.jsx(I,{fullWidth:!0,placeholder:"Search locations by name or address...",variant:"outlined",size:"small",value:x,onChange:o=>X(o.target.value),InputProps:{startAdornment:e.jsx(he,{position:"start",children:e.jsx(de,{})})}})}),Q?e.jsx(m,{sx:{textAlign:"center",py:8},children:e.jsx(ye,{})}):W.length>0?e.jsx(m,{sx:{py:2,display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)",lg:"repeat(4, 1fr)"},gap:{xs:2,sm:3},width:"100%"},children:W.map((o,s)=>e.jsxs(H,{elevation:3,sx:{borderRadius:2,overflow:"hidden",position:"relative",height:"100%",display:"flex",flexDirection:"column",background:i?a(t.palette.background.paper,.15):t.palette.background.paper,border:"1px solid",borderColor:i?a("rgb(250, 167, 43)",.2):a(t.palette.divider,.5),transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:t.shadows[8],borderColor:i?a("rgb(248, 166, 43)",.4):a(t.palette.primary.main,.3)}},children:[e.jsxs(m,{onClick:()=>R(o),sx:{p:2,display:"flex",alignItems:"center",gap:1.5,borderBottom:"1px solid",borderColor:i?a(t.palette.divider,.2):t.palette.divider,background:o.isHome?i?a("rgb(252, 165, 35)",.15):a(t.palette.primary.light,.15):i?a("rgb(251, 165, 45)",.1):a(t.palette.secondary.light,.08),cursor:"pointer","&:hover":{background:o.isHome?i?a("#FF9800",.2):a(t.palette.primary.light,.25):i?a("rgb(255, 144, 34)",.15):a(t.palette.secondary.light,.15)}},children:[e.jsx(m,{sx:{borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",p:1,background:i?a(t.palette.common.white,.05):a(t.palette.common.black,.03),boxShadow:`0 0 0 2px ${o.isHome?i?a("#FF9800",.5):a(t.palette.primary.main,.4):i?a("#FF5722",.5):a(t.palette.secondary.main,.4)}`},children:o.isHome?e.jsx(pe,{sx:{color:i?"#FFB74D":t.palette.primary.main,fontSize:28}}):e.jsx(T,{sx:{color:i?"#FF8A65":t.palette.secondary.main,fontSize:28}})}),e.jsx(f,{variant:"h6",sx:{fontWeight:600,color:i?"#FAFAFA":t.palette.text.primary,fontSize:{xs:"1rem",sm:"1.1rem"},flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o.name})]}),e.jsxs(m,{sx:{p:2,cursor:"pointer",flexGrow:1,display:"flex",flexDirection:"column"},onClick:()=>R(o),children:[e.jsx(f,{variant:"body1",sx:{color:i?"#E0E0E0":t.palette.text.secondary,mb:1,fontSize:"0.9rem",wordBreak:"break-word"},children:o.address}),o.notes&&e.jsx(f,{variant:"body2",sx:{color:i?a("#E0E0E0",.7):a(t.palette.text.secondary,.8),fontSize:"0.8rem",mt:"auto",pt:1,fontStyle:"italic"},children:o.notes})]}),e.jsxs(m,{sx:{display:"flex",justifyContent:"space-between",borderTop:"1px solid",borderColor:i?a(t.palette.divider,.2):t.palette.divider,bgcolor:i?a("#424242",.7):a(t.palette.background.default,.5),mt:"auto"},children:[e.jsx(k,{"aria-label":"Edit location",onClick:r=>{r.stopPropagation(),E(s)},sx:{flex:1,color:i?"#4FC3F7":t.palette.info.main,py:1.2,borderRadius:0,"&:hover":{bgcolor:i?a("#4FC3F7",.1):a(t.palette.info.main,.08)}},children:e.jsx(ce,{fontSize:"small"})}),e.jsx(ie,{orientation:"vertical",flexItem:!0}),e.jsx(k,{"aria-label":"Delete location",onClick:r=>{r.stopPropagation(),ee(s)},sx:{flex:1,color:i?"#EF9A9A":t.palette.error.main,py:1.2,borderRadius:0,"&:hover":{bgcolor:i?a("#EF9A9A",.1):a(t.palette.error.main,.08)}},children:e.jsx(le,{fontSize:"small"})})]})]},o.id||s))}):e.jsxs(H,{elevation:2,sx:{p:5,borderRadius:2,textAlign:"center",bgcolor:i?a(t.palette.background.paper,.4):t.palette.background.paper},children:[e.jsx(T,{sx:{fontSize:60,color:"text.secondary",opacity:.5,mb:2}}),e.jsx(f,{variant:"h6",gutterBottom:!0,children:"No locations saved yet"}),e.jsx(f,{variant:"body1",color:"text.secondary",paragraph:!0,children:x?"No locations match your search criteria":"Add your important places to easily find them later"}),e.jsx(j,{variant:"contained",color:"primary",startIcon:e.jsx(q,{}),onClick:()=>E(),sx:{mt:2},children:"Add First Location"})]})]}),e.jsxs(U,{open:Y,onClose:F,maxWidth:"sm",fullWidth:!0,children:[e.jsx(V,{children:b!==null?"Edit Location":"Add New Location"}),e.jsx(_,{children:e.jsxs(m,{sx:{mt:1,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(I,{fullWidth:!0,label:"Location Name",name:"name",value:l.name,onChange:S,required:!0,variant:"outlined",margin:"dense",placeholder:"Home, Work, etc."}),e.jsxs(m,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(I,{fullWidth:!0,label:"Address",name:"address",value:l.address,onChange:S,required:!0,variant:"outlined",margin:"dense",placeholder:"Enter full address",multiline:!0,rows:2}),e.jsx(k,{onClick:te,sx:{mt:1},children:e.jsx(fe,{})})]}),e.jsx(I,{fullWidth:!0,label:"Notes (optional)",name:"notes",value:l.notes||"",onChange:S,variant:"outlined",margin:"dense",placeholder:"Any additional details about this location",multiline:!0,rows:3}),e.jsxs(m,{sx:{display:"flex",alignItems:"center",mt:1},children:[e.jsx("input",{type:"checkbox",id:"isHome",name:"isHome",checked:l.isHome||!1,onChange:S}),e.jsx("label",{htmlFor:"isHome",style:{marginLeft:8},children:"Set as home location"})]})]})}),e.jsxs(G,{children:[e.jsx(j,{onClick:F,children:"Cancel"}),e.jsx(j,{onClick:Z,variant:"contained",color:"primary",children:"Save"})]})]}),e.jsxs(U,{open:L.open,onClose:N,children:[e.jsx(V,{children:"Confirm Deletion"}),e.jsx(_,{children:e.jsxs(f,{children:['Are you sure you want to delete "',L.locationName,'"? This action cannot be undone.']})}),e.jsxs(G,{children:[e.jsx(j,{onClick:N,children:"Cancel"}),e.jsx(j,{onClick:oe,color:"error",children:"Delete"})]})]}),e.jsx(xe,{open:C.open,autoHideDuration:6e3,onClose:P,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ge,{onClose:P,severity:C.severity,children:C.message})})]})},ye=()=>e.jsx(m,{sx:{display:"inline-block",width:40,height:40,border:"4px solid rgba(0, 0, 0, 0.1)",borderRadius:"50%",borderTopColor:"primary.main",animation:"spin 1s ease-in-out infinite","@keyframes spin":{to:{transform:"rotate(360deg)"}}}});export{He as default};
