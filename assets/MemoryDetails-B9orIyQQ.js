import{bn as P,u as W,r as d,j as e,C as m,a6 as R,T as s,a as i,A as u,F as A,B as t,P as _,g as x,aY as F,L,af as q,H,aA as T,aF as Y,aJ as G,bc as O}from"./vendor-BpQ4GIZC.js";import{s as p}from"./addMemory-C0-Amh-w.js";import{A as U}from"./index-AR_LmOrU.js";const V=()=>{const{id:n}=P(),f=W(),[r,j]=d.useState(null),[v,w]=d.useState(!0),[y,l]=d.useState("");d.useEffect(()=>{(async()=>{try{const{data:{user:a},error:S}=await p.auth.getUser();if(S||!a)throw new Error("User not authenticated");const{data:c,error:g}=await p.from("memories").select("*").eq("id",n).single();if(g)throw g;if(!c){l("Memory not found");return}if(c.user_id===a.id){j(c);return}const{data:b,error:M}=await p.from("family_members").select("patient_id").eq("id",a.id).single();if(M||!b){l("You do not have permission to view this memory");return}c.user_id===b.patient_id?j(c):l("You do not have permission to view this memory")}catch(a){console.error("Error fetching memory:",a.message),l("Error loading memory")}finally{w(!1)}})()},[n]);const h=()=>{f(-1)},C=()=>{console.log("Edit memory:",n)},E=async()=>{try{const{error:o}=await p.from("memories").delete().eq("id",n);if(o)throw o;f(-1)}catch(o){console.error("Error deleting memory:",o.message),l("Error deleting memory")}},I=()=>{console.log("Share memory:",n)},k=o=>{const a={year:"numeric",month:"long",day:"numeric"};return new Date(o).toLocaleDateString(void 0,a)},D=o=>{switch(o){case"polaroid":return{border:"15px solid white",boxShadow:"0 4px 15px rgba(0, 0, 0, 0.1)",transform:"rotate(-2deg)",mb:2};case"sepia":return{filter:"sepia(100%)",border:"5px solid #d4b483",mb:2};case"vintage":return{filter:"grayscale(50%)",border:"8px solid #f5f5f5",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.15)",mb:2};default:return{mb:2}}},B=()=>{if(!r)return null;switch(r.type){case"photo":return e.jsx(t,{sx:{mb:4},children:e.jsx(O,{component:"img",image:r.content,alt:r.title,sx:{width:"100%",maxHeight:"500px",objectFit:"contain",borderRadius:2,...D(r.filter)}})});case"voice":return e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:3,mb:4,bgcolor:"background.paper",borderRadius:2,border:"1px solid",borderColor:"divider"},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Voice Recording"}),e.jsx(t,{sx:{width:"100%"},children:e.jsx(U,{filePath:r.content,showControls:!0})})]});case"text":return e.jsx(t,{sx:{p:3,mb:4,bgcolor:"background.paper",borderRadius:2,border:"1px solid",borderColor:"divider",fontStyle:"italic",lineHeight:1.8},children:e.jsx(s,{variant:"body1",paragraph:!0,children:r.content})});default:return null}};return v?e.jsx(m,{maxWidth:"md",sx:{mt:4,mb:4,display:"flex",justifyContent:"center"},children:e.jsx(R,{})}):y?e.jsxs(m,{maxWidth:"md",sx:{mt:4,mb:4},children:[e.jsx(s,{color:"error",children:y}),e.jsx(i,{startIcon:e.jsx(u,{}),onClick:h,sx:{mt:2},children:"Go Back"})]}):r?e.jsx(m,{maxWidth:"md",sx:{mt:2,mb:4},children:e.jsxs(A.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},style:{width:"100%"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:4},children:[e.jsx(i,{startIcon:e.jsx(u,{}),onClick:h,sx:{mr:2},children:"Back"}),e.jsx(s,{variant:"h4",component:"h1",children:"Memory Details"})]}),e.jsxs(_,{elevation:2,sx:{p:3,borderRadius:3},children:[e.jsxs(t,{sx:{mb:3},children:[e.jsx(s,{variant:"h4",component:"h2",gutterBottom:!0,children:r.title}),e.jsxs(t,{sx:{display:"flex",flexWrap:"wrap",gap:2,mb:2},children:[e.jsx(x,{icon:e.jsx(F,{}),label:k(r.date),variant:"outlined"}),r.location&&e.jsx(x,{icon:e.jsx(L,{}),label:r.location,variant:"outlined"}),r.people&&r.people.length>0&&e.jsx(x,{icon:e.jsx(q,{}),label:`${r.people.length} ${r.people.length===1?"person":"people"}`,variant:"outlined"})]})]}),B(),r.description&&e.jsxs(t,{sx:{mb:4},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Description"}),e.jsx(s,{variant:"body1",paragraph:!0,children:r.description})]}),r.people&&r.people.length>0&&e.jsxs(t,{sx:{mb:4},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"People"}),e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:r.people.map((o,a)=>e.jsx(x,{label:o},a))})]}),e.jsx(H,{sx:{my:3}}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsx(i,{variant:"outlined",color:"error",startIcon:e.jsx(T,{}),onClick:E,children:"Delete"}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(i,{variant:"outlined",startIcon:e.jsx(Y,{}),onClick:I,children:"Share"}),e.jsx(i,{variant:"contained",color:"primary",startIcon:e.jsx(G,{}),onClick:C,children:"Edit"})]})]})]})]})}):e.jsxs(m,{maxWidth:"md",sx:{mt:4,mb:4},children:[e.jsx(s,{children:"Memory not found"}),e.jsx(i,{startIcon:e.jsx(u,{}),onClick:h,sx:{mt:2},children:"Go Back"})]})};export{V as default};
