import{r as t,M as A,j as E,u as v,az as S,aA as W,a as b,aB as B}from"./index-CXEbI5Qv.js";class D extends t.Component{getSnapshotBeforeUpdate(l){const e=this.props.childRef.current;if(e&&l.isPresent&&!this.props.isPresent){const r=e.offsetParent,u=r instanceof HTMLElement&&r.offsetWidth||0,n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft,n.right=u-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function H({children:c,isPresent:l,anchorX:e}){const r=t.useId(),u=t.useRef(null),n=t.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:h}=t.useContext(A);return t.useInsertionEffect(()=>{const{width:x,height:o,top:m,left:s,right:p}=n.current;if(l||!u.current||!x||!o)return;const a=e==="left"?`left: ${s}`:`right: ${p}`;u.current.dataset.motionPopId=r;const f=document.createElement("style");return h&&(f.nonce=h),document.head.appendChild(f),f.sheet&&f.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${x}px !important;
            height: ${o}px !important;
            ${a}px !important;
            top: ${m}px !important;
          }
        `),()=>{document.head.removeChild(f)}},[l]),E.jsx(D,{isPresent:l,childRef:u,sizeRef:n,children:t.cloneElement(c,{ref:u})})}const K=({children:c,initial:l,isPresent:e,onExitComplete:r,custom:u,presenceAffectsLayout:n,mode:h,anchorX:x})=>{const o=v(U),m=t.useId(),s=t.useCallback(a=>{o.set(a,!0);for(const f of o.values())if(!f)return;r&&r()},[o,r]),p=t.useMemo(()=>({id:m,initial:l,isPresent:e,custom:u,onExitComplete:s,register:a=>(o.set(a,!1),()=>o.delete(a))}),n?[Math.random(),s]:[e,s]);return t.useMemo(()=>{o.forEach((a,f)=>o.set(f,!1))},[e]),t.useEffect(()=>{!e&&!o.size&&r&&r()},[e]),h==="popLayout"&&(c=E.jsx(H,{isPresent:e,anchorX:x,children:c})),E.jsx(S.Provider,{value:p,children:c})};function U(){return new Map}const M=c=>c.key||"";function $(c){const l=[];return t.Children.forEach(c,e=>{t.isValidElement(e)&&l.push(e)}),l}const G=({children:c,custom:l,initial:e=!0,onExitComplete:r,presenceAffectsLayout:u=!0,mode:n="sync",propagate:h=!1,anchorX:x="left"})=>{const[o,m]=W(h),s=t.useMemo(()=>$(c),[c]),p=h&&!o?[]:s.map(M),a=t.useRef(!0),f=t.useRef(s),g=v(()=>new Map),[k,I]=t.useState(s),[C,j]=t.useState(s);b(()=>{a.current=!1,f.current=s;for(let d=0;d<C.length;d++){const i=M(C[d]);p.includes(i)?g.delete(i):g.get(i)!==!0&&g.set(i,!1)}},[C,p.length,p.join("-")]);const P=[];if(s!==k){let d=[...s];for(let i=0;i<C.length;i++){const y=C[i],w=M(y);p.includes(w)||(d.splice(i,0,y),P.push(y))}return n==="wait"&&P.length&&(d=P),j($(d)),I(s),null}const{forceRender:R}=t.useContext(B);return E.jsx(E.Fragment,{children:C.map(d=>{const i=M(d),y=h&&!o?!1:s===C||p.includes(i),w=()=>{if(g.has(i))g.set(i,!0);else return;let z=!0;g.forEach(L=>{L||(z=!1)}),z&&(R==null||R(),j(f.current),h&&(m==null||m()),r&&r())};return E.jsx(K,{isPresent:y,initial:!a.current||e?void 0:!1,custom:l,presenceAffectsLayout:u,mode:n,onExitComplete:y?void 0:w,anchorX:x,children:d},i)})})};export{G as A};
