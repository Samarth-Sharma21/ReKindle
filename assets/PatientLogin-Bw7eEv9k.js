import{e as z,v as q,r as n,j as e,B as x,q as B,n as s,L as l,P as R,l as F,s as v,I as _,w as V,x as m}from"./index-BmLVi8vg.js";import{V as G,a as H}from"./VisibilityOff-DJTqgFq4.js";import{A as M}from"./ArrowBack-BAfnpC9L.js";import{C as N}from"./Chatbot-B0psx8_j.js";import{C as O}from"./Container-Bvb4e2sG.js";import{A as J}from"./Alert-DHf0O5zk.js";import{T as P}from"./TextField-BSr3M5TF.js";import{I as K}from"./InputAdornment-BIraHNGR.js";import{G as p}from"./Grid-le5V3Wf4.js";import"./Close-xF6ax2C8.js";import"./cjs-T6Auk3jY.js";import"./useFormControl-c-FtK5bv.js";const ie=()=>{const I=z(),{login:W}=q(),[t,D]=n.useState({email:"",password:""}),[d,S]=n.useState(!1),[f,o]=n.useState(""),[h,a]=n.useState(!1),g=c=>{const{name:r,value:u}=c.target;D({...t,[r]:u})},A=()=>{S(!d)},C=async c=>{if(c.preventDefault(),a(!0),!t.email||!t.password){o("Please fill in all fields"),a(!1);return}try{const{data:r,error:u}=await m.auth.signInWithPassword({email:t.email,password:t.password});if(u){o("Invalid email or password"),a(!1);return}const{data:i,error:E}=await m.from("patients").select("*").eq("id",r.user.id).single();if(E){o("Error fetching patient data"),a(!1);return}console.log("Patient authenticated:",i);const{data:y,error:L}=await m.from("family_members").select("id, name, relationship").eq("patient_id",r.user.id);let b=[];!L&&y&&(b=y);const{data:j,error:T}=await m.from("memories").select("*").eq("user_id",r.user.id).order("created_at",{ascending:!1}).limit(5);let w=[];!T&&j&&(w=j);const k={id:r.user.id,name:i.name,email:i.email,mobile:i.mobile,familyMembers:b,memories:w};W("patient",k),I("/patient/dashboard")}catch(r){console.error("Error logging in:",r.message),o("Authentication error. Please try again.")}finally{a(!1)}};return e.jsxs(x,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",bgcolor:"background.default",py:4},children:[e.jsx(N,{}),e.jsx(O,{maxWidth:"sm",children:e.jsxs(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx(s,{component:l,to:"/",startIcon:e.jsx(M,{}),sx:{mb:4},children:"Back to Home"}),e.jsxs(R,{elevation:3,sx:{p:4,borderRadius:2,bgcolor:"background.paper"},children:[e.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3},children:[e.jsx(x,{sx:{mb:3},children:e.jsx(F,{size:"large"})}),e.jsx(v,{variant:"body1",color:"text.secondary",align:"center",sx:{mb:4,maxWidth:"400px",mx:"auto"},children:"Welcome back! Please log in to access your memories."})]}),f&&e.jsx(J,{severity:"error",sx:{mb:3},children:f}),e.jsxs("form",{onSubmit:C,children:[e.jsx(P,{fullWidth:!0,label:"Email Address",name:"email",type:"email",value:t.email,onChange:g,margin:"normal",variant:"outlined",required:!0,InputProps:{sx:{borderRadius:2,fontSize:"1.1rem"}}}),e.jsx(P,{fullWidth:!0,label:"Password",name:"password",type:d?"text":"password",value:t.password,onChange:g,margin:"normal",variant:"outlined",required:!0,InputProps:{sx:{borderRadius:2,fontSize:{xs:"0.9rem",sm:"1.1rem"}},endAdornment:e.jsx(K,{position:"end",children:e.jsx(_,{onClick:A,edge:"end","aria-label":"toggle password visibility",children:d?e.jsx(G,{}):e.jsx(H,{})})})}}),e.jsx(s,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",size:"large",disabled:h,sx:{mt:3,mb:2,py:{xs:1.2,sm:1.5},fontSize:{xs:"0.95rem",sm:"1.1rem"},fontWeight:600,textTransform:"none",borderRadius:2},children:h?"Logging in...":"Log In"}),e.jsxs(p,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(s,{component:l,to:"/forgot-password",fullWidth:!0,color:"primary",sx:{textTransform:"none"},children:"Forgot Password?"})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(s,{component:l,to:"/patient/register",fullWidth:!0,color:"primary",sx:{textTransform:"none"},children:"Create Account"})})]}),e.jsx(V,{sx:{my:3},children:e.jsx(v,{variant:"body2",color:"text.secondary",children:"or"})}),e.jsx(s,{component:l,to:"/family/login",fullWidth:!0,variant:"outlined",color:"primary",size:"large",sx:{py:{xs:1.2,sm:1.5},fontSize:{xs:"0.95rem",sm:"1.1rem"},fontWeight:600,textTransform:"none",borderRadius:2},children:"Log In as Family Member"})]})]})]})})]})};export{ie as default};
