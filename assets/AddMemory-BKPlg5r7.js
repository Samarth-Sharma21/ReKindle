import{n as W,o as O,r as n,p as q,a5 as Se,j as r,x as k,y as E,R as U,z as _,E as T,W as G,a6 as Ce,a7 as Le,a0 as oe,a1 as ne,c as ae,a8 as Re,O as X,B as P,g as M,P as ie,a4 as z,d as F,h as we,s as $,m as Pe,I as de,u as Ie,k as Me,a9 as ke}from"./index-7zbgi2qQ.js";import{A as $e}from"./ArrowBack-c1su4zvR.js";import{L as xe}from"./LocationOn-C8IIlvBM.js";import{P as Ue}from"./Photo-xxW79_wU.js";import{M as Q,T as Ne}from"./TextSnippet-B-YBFLuU.js";import{P as Te}from"./People-DYlJNTcD.js";import{A as Ae}from"./Add-jpXRy77u.js";import{P as Be,a as ze}from"./Pause-CGfYM-Jy.js";import{D as Ee}from"./Delete-BrPxrsmS.js";import{S as Fe}from"./Slider-a8a6VxD5.js";import{S as he}from"./Stack-Dn7T48sQ.js";import{A as We}from"./AddPhotoAlternate-BiBCgDUZ.js";import{G as A}from"./Grid-1SM4JlKV.js";import{F as pe,I as ue,S as me,T as V}from"./TextField-CCuzYXtS.js";import{C as be}from"./Chip-BeyJDWoI.js";import{S as Oe}from"./Snackbar-BzNAqPSb.js";import{A as Y}from"./Alert-BRbQA1fK.js";import{C as qe}from"./Container-DZq_lvjJ.js";import"./useFormControl-CcItWjiD.js";function _e(t){return W("MuiLinearProgress",t)}O("MuiLinearProgress",["root","colorPrimary","colorSecondary","determinate","indeterminate","buffer","query","dashed","dashedColorPrimary","dashedColorSecondary","bar","bar1","bar2","barColorPrimary","barColorSecondary","bar1Indeterminate","bar1Determinate","bar1Buffer","bar2Indeterminate","bar2Buffer"]);const Z=4,ee=ne`
  0% {
    left: -35%;
    right: 100%;
  }

  60% {
    left: 100%;
    right: -90%;
  }

  100% {
    left: 100%;
    right: -90%;
  }
`,Ve=typeof ee!="string"?oe`
        animation: ${ee} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
      `:null,te=ne`
  0% {
    left: -200%;
    right: 100%;
  }

  60% {
    left: 107%;
    right: -8%;
  }

  100% {
    left: 107%;
    right: -8%;
  }
`,Ge=typeof te!="string"?oe`
        animation: ${te} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite;
      `:null,re=ne`
  0% {
    opacity: 1;
    background-position: 0 -23px;
  }

  60% {
    opacity: 0;
    background-position: 0 -23px;
  }

  100% {
    opacity: 1;
    background-position: -200px -23px;
  }
`,He=typeof re!="string"?oe`
        animation: ${re} 3s infinite linear;
      `:null,Ke=t=>{const{classes:e,variant:o,color:a}=t,s={root:["root",`color${U(a)}`,o],dashed:["dashed",`dashedColor${U(a)}`],bar1:["bar","bar1",`barColor${U(a)}`,(o==="indeterminate"||o==="query")&&"bar1Indeterminate",o==="determinate"&&"bar1Determinate",o==="buffer"&&"bar1Buffer"],bar2:["bar","bar2",o!=="buffer"&&`barColor${U(a)}`,o==="buffer"&&`color${U(a)}`,(o==="indeterminate"||o==="query")&&"bar2Indeterminate",o==="buffer"&&"bar2Buffer"]};return _(s,_e,e)},se=(t,e)=>t.vars?t.vars.palette.LinearProgress[`${e}Bg`]:t.palette.mode==="light"?Ce(t.palette[e].main,.62):Le(t.palette[e].main,.5),Xe=k("span",{name:"MuiLinearProgress",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:o}=t;return[e.root,e[`color${U(o.color)}`],e[o.variant]]}})(T(({theme:t})=>({position:"relative",overflow:"hidden",display:"block",height:4,zIndex:0,"@media print":{colorAdjust:"exact"},variants:[...Object.entries(t.palette).filter(G()).map(([e])=>({props:{color:e},style:{backgroundColor:se(t,e)}})),{props:({ownerState:e})=>e.color==="inherit"&&e.variant!=="buffer",style:{"&::before":{content:'""',position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"currentColor",opacity:.3}}},{props:{variant:"buffer"},style:{backgroundColor:"transparent"}},{props:{variant:"query"},style:{transform:"rotate(180deg)"}}]}))),De=k("span",{name:"MuiLinearProgress",slot:"Dashed",overridesResolver:(t,e)=>{const{ownerState:o}=t;return[e.dashed,e[`dashedColor${U(o.color)}`]]}})(T(({theme:t})=>({position:"absolute",marginTop:0,height:"100%",width:"100%",backgroundSize:"10px 10px",backgroundPosition:"0 -23px",variants:[{props:{color:"inherit"},style:{opacity:.3,backgroundImage:"radial-gradient(currentColor 0%, currentColor 16%, transparent 42%)"}},...Object.entries(t.palette).filter(G()).map(([e])=>{const o=se(t,e);return{props:{color:e},style:{backgroundImage:`radial-gradient(${o} 0%, ${o} 16%, transparent 42%)`}}})]})),He||{animation:`${re} 3s infinite linear`}),Je=k("span",{name:"MuiLinearProgress",slot:"Bar1",overridesResolver:(t,e)=>{const{ownerState:o}=t;return[e.bar,e.bar1,e[`barColor${U(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&e.bar1Indeterminate,o.variant==="determinate"&&e.bar1Determinate,o.variant==="buffer"&&e.bar1Buffer]}})(T(({theme:t})=>({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",variants:[{props:{color:"inherit"},style:{backgroundColor:"currentColor"}},...Object.entries(t.palette).filter(G()).map(([e])=>({props:{color:e},style:{backgroundColor:(t.vars||t).palette[e].main}})),{props:{variant:"determinate"},style:{transition:`transform .${Z}s linear`}},{props:{variant:"buffer"},style:{zIndex:1,transition:`transform .${Z}s linear`}},{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:{width:"auto"}},{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:Ve||{animation:`${ee} 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite`}}]}))),Qe=k("span",{name:"MuiLinearProgress",slot:"Bar2",overridesResolver:(t,e)=>{const{ownerState:o}=t;return[e.bar,e.bar2,e[`barColor${U(o.color)}`],(o.variant==="indeterminate"||o.variant==="query")&&e.bar2Indeterminate,o.variant==="buffer"&&e.bar2Buffer]}})(T(({theme:t})=>({width:"100%",position:"absolute",left:0,bottom:0,top:0,transition:"transform 0.2s linear",transformOrigin:"left",variants:[...Object.entries(t.palette).filter(G()).map(([e])=>({props:{color:e},style:{"--LinearProgressBar2-barColor":(t.vars||t).palette[e].main}})),{props:({ownerState:e})=>e.variant!=="buffer"&&e.color!=="inherit",style:{backgroundColor:"var(--LinearProgressBar2-barColor, currentColor)"}},{props:({ownerState:e})=>e.variant!=="buffer"&&e.color==="inherit",style:{backgroundColor:"currentColor"}},{props:{color:"inherit"},style:{opacity:.3}},...Object.entries(t.palette).filter(G()).map(([e])=>({props:{color:e,variant:"buffer"},style:{backgroundColor:se(t,e),transition:`transform .${Z}s linear`}})),{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:{width:"auto"}},{props:({ownerState:e})=>e.variant==="indeterminate"||e.variant==="query",style:Ge||{animation:`${te} 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) 1.15s infinite`}}]}))),Ye=n.forwardRef(function(e,o){const a=q({props:e,name:"MuiLinearProgress"}),{className:s,color:p="primary",value:x,valueBuffer:u,variant:m="indeterminate",...h}=a,d={...a,color:p,variant:m},i=Ke(d),b=Se(),v={},g={bar1:{},bar2:{}};if((m==="determinate"||m==="buffer")&&x!==void 0){v["aria-valuenow"]=Math.round(x),v["aria-valuemin"]=0,v["aria-valuemax"]=100;let y=x-100;b&&(y=-y),g.bar1.transform=`translateX(${y}%)`}if(m==="buffer"&&u!==void 0){let y=(u||0)-100;b&&(y=-y),g.bar2.transform=`translateX(${y}%)`}return r.jsxs(Xe,{className:E(i.root,s),ownerState:d,role:"progressbar",...v,ref:o,...h,children:[m==="buffer"?r.jsx(De,{className:i.dashed,ownerState:d}):null,r.jsx(Je,{className:i.bar1,ownerState:d,style:g.bar1}),m==="determinate"?null:r.jsx(Qe,{className:i.bar2,ownerState:d,style:g.bar2})]})}),K=n.createContext({}),le=n.createContext({});function Ze(t){return W("MuiStep",t)}O("MuiStep",["root","horizontal","vertical","alternativeLabel","completed"]);const et=t=>{const{classes:e,orientation:o,alternativeLabel:a,completed:s}=t;return _({root:["root",o,a&&"alternativeLabel",s&&"completed"]},Ze,e)},tt=k("div",{name:"MuiStep",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:o}=t;return[e.root,e[o.orientation],o.alternativeLabel&&e.alternativeLabel,o.completed&&e.completed]}})({variants:[{props:{orientation:"horizontal"},style:{paddingLeft:8,paddingRight:8}},{props:{alternativeLabel:!0},style:{flex:1,position:"relative"}}]}),rt=n.forwardRef(function(e,o){const a=q({props:e,name:"MuiStep"}),{active:s,children:p,className:x,component:u="div",completed:m,disabled:h,expanded:d=!1,index:i,last:b,...v}=a,{activeStep:g,connector:y,alternativeLabel:L,orientation:l,nonLinear:j}=n.useContext(K);let[w=!1,c=!1,f=!1]=[s,m,h];g===i?w=s!==void 0?s:!0:!j&&g>i?c=m!==void 0?m:!0:!j&&g<i&&(f=h!==void 0?h:!0);const I=n.useMemo(()=>({index:i,last:b,expanded:d,icon:i+1,active:w,completed:c,disabled:f}),[i,b,d,w,c,f]),R={...a,active:w,orientation:l,alternativeLabel:L,completed:c,disabled:f,expanded:d,component:u},S=et(R),C=r.jsxs(tt,{as:u,className:E(S.root,x),ref:o,ownerState:R,...v,children:[y&&L&&i!==0?y:null,p]});return r.jsx(le.Provider,{value:I,children:y&&!L&&i!==0?r.jsxs(n.Fragment,{children:[y,C]}):C})}),ot=ae(r.jsx("path",{d:"M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm-2 17l-5-5 1.4-1.4 3.6 3.6 7.6-7.6L19 8l-9 9z"})),nt=ae(r.jsx("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"}));function at(t){return W("MuiStepIcon",t)}const D=O("MuiStepIcon",["root","active","completed","error","text"]);var fe;const it=t=>{const{classes:e,active:o,completed:a,error:s}=t;return _({root:["root",o&&"active",a&&"completed",s&&"error"],text:["text"]},at,e)},J=k(Re,{name:"MuiStepIcon",slot:"Root",overridesResolver:(t,e)=>e.root})(T(({theme:t})=>({display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),color:(t.vars||t).palette.text.disabled,[`&.${D.completed}`]:{color:(t.vars||t).palette.primary.main},[`&.${D.active}`]:{color:(t.vars||t).palette.primary.main},[`&.${D.error}`]:{color:(t.vars||t).palette.error.main}}))),st=k("text",{name:"MuiStepIcon",slot:"Text",overridesResolver:(t,e)=>e.text})(T(({theme:t})=>({fill:(t.vars||t).palette.primary.contrastText,fontSize:t.typography.caption.fontSize,fontFamily:t.typography.fontFamily}))),lt=n.forwardRef(function(e,o){const a=q({props:e,name:"MuiStepIcon"}),{active:s=!1,className:p,completed:x=!1,error:u=!1,icon:m,...h}=a,d={...a,active:s,completed:x,error:u},i=it(d);if(typeof m=="number"||typeof m=="string"){const b=E(p,i.root);return u?r.jsx(J,{as:nt,className:b,ref:o,ownerState:d,...h}):x?r.jsx(J,{as:ot,className:b,ref:o,ownerState:d,...h}):r.jsxs(J,{className:b,ref:o,ownerState:d,...h,children:[fe||(fe=r.jsx("circle",{cx:"12",cy:"12",r:"12"})),r.jsx(st,{className:i.text,x:"12",y:"12",textAnchor:"middle",dominantBaseline:"central",ownerState:d,children:m})]})}return m});function ct(t){return W("MuiStepLabel",t)}const B=O("MuiStepLabel",["root","horizontal","vertical","label","active","completed","error","disabled","iconContainer","alternativeLabel","labelContainer"]),dt=t=>{const{classes:e,orientation:o,active:a,completed:s,error:p,disabled:x,alternativeLabel:u}=t;return _({root:["root",o,p&&"error",x&&"disabled",u&&"alternativeLabel"],label:["label",a&&"active",s&&"completed",p&&"error",x&&"disabled",u&&"alternativeLabel"],iconContainer:["iconContainer",a&&"active",s&&"completed",p&&"error",x&&"disabled",u&&"alternativeLabel"],labelContainer:["labelContainer",u&&"alternativeLabel"]},ct,e)},pt=k("span",{name:"MuiStepLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:o}=t;return[e.root,e[o.orientation]]}})({display:"flex",alignItems:"center",[`&.${B.alternativeLabel}`]:{flexDirection:"column"},[`&.${B.disabled}`]:{cursor:"default"},variants:[{props:{orientation:"vertical"},style:{textAlign:"left",padding:"8px 0"}}]}),ut=k("span",{name:"MuiStepLabel",slot:"Label",overridesResolver:(t,e)=>e.label})(T(({theme:t})=>({...t.typography.body2,display:"block",transition:t.transitions.create("color",{duration:t.transitions.duration.shortest}),[`&.${B.active}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${B.completed}`]:{color:(t.vars||t).palette.text.primary,fontWeight:500},[`&.${B.alternativeLabel}`]:{marginTop:16},[`&.${B.error}`]:{color:(t.vars||t).palette.error.main}}))),mt=k("span",{name:"MuiStepLabel",slot:"IconContainer",overridesResolver:(t,e)=>e.iconContainer})({flexShrink:0,display:"flex",paddingRight:8,[`&.${B.alternativeLabel}`]:{paddingRight:0}}),ft=k("span",{name:"MuiStepLabel",slot:"LabelContainer",overridesResolver:(t,e)=>e.labelContainer})(T(({theme:t})=>({width:"100%",color:(t.vars||t).palette.text.secondary,[`&.${B.alternativeLabel}`]:{textAlign:"center"}}))),ve=n.forwardRef(function(e,o){const a=q({props:e,name:"MuiStepLabel"}),{children:s,className:p,componentsProps:x={},error:u=!1,icon:m,optional:h,slots:d={},slotProps:i={},StepIconComponent:b,StepIconProps:v,...g}=a,{alternativeLabel:y,orientation:L}=n.useContext(K),{active:l,disabled:j,completed:w,icon:c}=n.useContext(le),f=m||c;let I=b;f&&!I&&(I=lt);const R={...a,active:l,alternativeLabel:y,completed:w,disabled:j,error:u,orientation:L},S=dt(R),C={slots:d,slotProps:{stepIcon:v,...x,...i}},[N,ge]=X("root",{elementType:pt,externalForwardedProps:{...C,...g},ownerState:R,ref:o,className:E(S.root,p)}),[ye,H]=X("label",{elementType:ut,externalForwardedProps:C,ownerState:R}),[ce,je]=X("stepIcon",{elementType:I,externalForwardedProps:C,ownerState:R});return r.jsxs(N,{...ge,children:[f||ce?r.jsx(mt,{className:S.iconContainer,ownerState:R,children:r.jsx(ce,{completed:w,active:l,error:u,icon:f,...je})}):null,r.jsxs(ft,{className:S.labelContainer,ownerState:R,children:[s?r.jsx(ye,{...H,className:E(S.label,H==null?void 0:H.className),children:s}):null,h]})]})});ve.muiName="StepLabel";function xt(t){return W("MuiStepConnector",t)}O("MuiStepConnector",["root","horizontal","vertical","alternativeLabel","active","completed","disabled","line","lineHorizontal","lineVertical"]);const ht=t=>{const{classes:e,orientation:o,alternativeLabel:a,active:s,completed:p,disabled:x}=t,u={root:["root",o,a&&"alternativeLabel",s&&"active",p&&"completed",x&&"disabled"],line:["line",`line${U(o)}`]};return _(u,xt,e)},bt=k("div",{name:"MuiStepConnector",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:o}=t;return[e.root,e[o.orientation],o.alternativeLabel&&e.alternativeLabel,o.completed&&e.completed]}})({flex:"1 1 auto",variants:[{props:{orientation:"vertical"},style:{marginLeft:12}},{props:{alternativeLabel:!0},style:{position:"absolute",top:12,left:"calc(-50% + 20px)",right:"calc(50% + 20px)"}}]}),vt=k("span",{name:"MuiStepConnector",slot:"Line",overridesResolver:(t,e)=>{const{ownerState:o}=t;return[e.line,e[`line${U(o.orientation)}`]]}})(T(({theme:t})=>{const e=t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[600];return{display:"block",borderColor:t.vars?t.vars.palette.StepConnector.border:e,variants:[{props:{orientation:"horizontal"},style:{borderTopStyle:"solid",borderTopWidth:1}},{props:{orientation:"vertical"},style:{borderLeftStyle:"solid",borderLeftWidth:1,minHeight:24}}]}})),gt=n.forwardRef(function(e,o){const a=q({props:e,name:"MuiStepConnector"}),{className:s,...p}=a,{alternativeLabel:x,orientation:u="horizontal"}=n.useContext(K),{active:m,disabled:h,completed:d}=n.useContext(le),i={...a,alternativeLabel:x,orientation:u,active:m,completed:d,disabled:h},b=ht(i);return r.jsx(bt,{className:E(b.root,s),ref:o,ownerState:i,...p,children:r.jsx(vt,{className:b.line,ownerState:i})})});function yt(t){return W("MuiStepper",t)}O("MuiStepper",["root","horizontal","vertical","nonLinear","alternativeLabel"]);const jt=t=>{const{orientation:e,nonLinear:o,alternativeLabel:a,classes:s}=t;return _({root:["root",e,o&&"nonLinear",a&&"alternativeLabel"]},yt,s)},St=k("div",{name:"MuiStepper",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:o}=t;return[e.root,e[o.orientation],o.alternativeLabel&&e.alternativeLabel,o.nonLinear&&e.nonLinear]}})({display:"flex",variants:[{props:{orientation:"horizontal"},style:{flexDirection:"row",alignItems:"center"}},{props:{orientation:"vertical"},style:{flexDirection:"column"}},{props:{alternativeLabel:!0},style:{alignItems:"flex-start"}}]}),Ct=r.jsx(gt,{}),Lt=n.forwardRef(function(e,o){const a=q({props:e,name:"MuiStepper"}),{activeStep:s=0,alternativeLabel:p=!1,children:x,className:u,component:m="div",connector:h=Ct,nonLinear:d=!1,orientation:i="horizontal",...b}=a,v={...a,nonLinear:d,alternativeLabel:p,orientation:i,component:m},g=jt(v),y=n.Children.toArray(x).filter(Boolean),L=y.map((j,w)=>n.cloneElement(j,{index:w,last:w+1===y.length,...j.props})),l=n.useMemo(()=>({activeStep:s,alternativeLabel:p,connector:h,nonLinear:d,orientation:i}),[s,p,h,d,i]);return r.jsx(K.Provider,{value:l,children:r.jsx(St,{as:m,ownerState:v,className:E(g.root,u),ref:o,...b,children:L})})}),Rt=({memoryData:t,setMemoryData:e})=>{var w;const[o,a]=n.useState("photo"),[s,p]=n.useState(""),[x,u]=n.useState(""),[m,h]=n.useState({open:!1,message:"",severity:"success"}),d=c=>{const{name:f,value:I}=c.target;e({...t,[f]:I})},i=c=>{const f=c.target.value;a(f),e({...t,type:f}),f==="photo"&&u("")},b=()=>{var c;s.trim()&&!((c=t.people)!=null&&c.includes(s.trim()))&&(e({...t,people:[...t.people||[],s.trim()]}),p(""))},v=c=>{e({...t,people:(t.people||[]).filter(f=>f!==c)})},g=async c=>{try{const f=c.name.split(".").pop(),R=`public/${`${Math.random()}.${f}`}`,{error:S}=await $.storage.from("memories").upload(R,c);if(S)throw S;const{data:{publicUrl:C}}=$.storage.from("memories").getPublicUrl(R);u(URL.createObjectURL(c)),e({...t,content:C,type:"photo"})}catch(f){console.error("Error uploading file:",f.message),l("Error uploading file. Please try again.","error")}},y=async c=>{try{const f=new File([c],"voice-recording.mp3",{type:"audio/mpeg"}),R=`public/${`${Math.random()}.mp3`}`;await $.storage.from("memories").remove([R]);const{error:S}=await $.storage.from("memories").upload(R,f,{contentType:"audio/mpeg",cacheControl:"3600",upsert:!0});if(S)throw S;const{data:{publicUrl:C}}=$.storage.from("memories").getPublicUrl(R);console.log("Uploaded audio URL:",C);try{if(!(await fetch(C)).ok)throw new Error("Audio file not accessible")}catch(N){throw console.error("Error testing audio URL:",N),new Error("Audio file not accessible")}e({...t,content:C,type:"voice"}),l("Voice recording saved successfully!","success")}catch(f){console.error("Error uploading audio:",f.message),l("Error uploading audio. Please try again.","error")}},L=c=>{if(c.preventDefault(),!t.title){l("Please enter a title for your memory","error");return}if(o==="photo"&&!x){l("Please upload a photo","error");return}if(o==="text"&&!t.content){l("Please enter some text for your memory","error");return}l("Memory saved successfully!","success")},l=(c,f)=>{h({open:!0,message:c,severity:f})},j=()=>{h({...m,open:!1})};return r.jsxs(P,{sx:{width:"100%",maxWidth:800,mx:"auto"},children:[r.jsx(M,{variant:"h4",component:"h1",gutterBottom:!0,children:"Create New Memory"}),r.jsx(ie,{elevation:3,sx:{p:3,borderRadius:2},children:r.jsx("form",{onSubmit:L,children:r.jsxs(A,{container:!0,spacing:3,children:[r.jsx(A,{item:!0,xs:12,children:r.jsxs(pe,{fullWidth:!0,children:[r.jsx(ue,{id:"memory-type-label",children:"Memory Type"}),r.jsxs(me,{labelId:"memory-type-label",id:"memory-type",value:o,label:"Memory Type",onChange:i,children:[r.jsx(z,{value:"photo",children:r.jsxs(P,{sx:{display:"flex",alignItems:"center"},children:[r.jsx(Ue,{sx:{mr:1}}),"Photo Memory"]})}),r.jsx(z,{value:"voice",children:r.jsxs(P,{sx:{display:"flex",alignItems:"center"},children:[r.jsx(Q,{sx:{mr:1}}),"Voice Memory"]})}),r.jsx(z,{value:"text",children:r.jsxs(P,{sx:{display:"flex",alignItems:"center"},children:[r.jsx(Ne,{sx:{mr:1}}),"Text Memory"]})})]})]})}),r.jsx(A,{item:!0,xs:12,sm:6,children:r.jsx(V,{required:!0,fullWidth:!0,label:"Memory Title",name:"title",value:t.title,onChange:d})}),r.jsx(A,{item:!0,xs:12,sm:6,children:r.jsx(V,{fullWidth:!0,label:"Date",type:"date",name:"date",value:t.date,onChange:d,InputLabelProps:{shrink:!0}})}),r.jsx(A,{item:!0,xs:12,children:r.jsx(V,{fullWidth:!0,label:"Location",name:"location",value:t.location||"",onChange:d,placeholder:"Enter or select a location",InputProps:{startAdornment:r.jsx(xe,{color:"action",sx:{mr:1}})}})}),r.jsxs(A,{item:!0,xs:12,children:[r.jsxs(P,{sx:{display:"flex",alignItems:"flex-start",mb:1},children:[r.jsx(V,{fullWidth:!0,label:"Add People in this Memory",value:s,onChange:c=>p(c.target.value),onKeyPress:c=>c.key==="Enter"&&b(),InputProps:{startAdornment:r.jsx(Te,{color:"action",sx:{mr:1}})},sx:{mr:1}}),r.jsx(F,{variant:"contained",color:"primary",onClick:b,disabled:!s.trim(),children:r.jsx(Ae,{})})]}),r.jsx(P,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:(w=t.people)==null?void 0:w.map(c=>r.jsx(be,{label:c,onDelete:()=>v(c),color:"primary",variant:"outlined"},c))})]}),r.jsx(A,{item:!0,xs:12,children:r.jsx(we,{sx:{my:2}})}),r.jsxs(A,{item:!0,xs:12,children:[r.jsx(M,{variant:"h6",gutterBottom:!0,children:"Memory Content"}),o==="photo"&&r.jsxs(P,{children:[r.jsx(M,{variant:"h6",gutterBottom:!0,children:"Upload a Photo"}),r.jsx(It,{onPhotoSelected:g,defaultImage:x}),r.jsxs(P,{sx:{mt:2},children:[r.jsx(M,{variant:"subtitle1",gutterBottom:!0,children:"Photo Filter"}),r.jsxs(pe,{fullWidth:!0,sx:{mb:2},children:[r.jsx(ue,{id:"filter-label",children:"Apply Filter"}),r.jsxs(me,{labelId:"filter-label",id:"filter",name:"filter",value:t.filter||"none",label:"Apply Filter",onChange:d,children:[r.jsx(z,{value:"none",children:"No Filter"}),r.jsx(z,{value:"polaroid",children:"Polaroid Frame"}),r.jsx(z,{value:"sepia",children:"Sepia Tone"}),r.jsx(z,{value:"vintage",children:"Vintage"})]})]}),x&&r.jsx(P,{sx:{mt:2,position:"relative"},children:r.jsx("img",{src:x,alt:"Memory Preview",style:{width:"100%",maxHeight:"300px",objectFit:"contain",borderRadius:t.filter==="none"?"4px":"0",border:t.filter==="polaroid"?"15px solid white":t.filter==="sepia"?"5px solid #d4b483":t.filter==="vintage"?"8px solid #f5f5f5":"none",boxShadow:t.filter!=="none"?"0 4px 8px rgba(0, 0, 0, 0.15)":"none",transform:t.filter==="polaroid"?"rotate(-2deg)":"none",filter:t.filter==="sepia"?"sepia(100%)":t.filter==="vintage"?"grayscale(50%)":"none"}})})]})]}),o==="voice"&&r.jsxs(P,{children:[r.jsx(M,{variant:"h6",gutterBottom:!0,children:"Record a Voice Memory"}),r.jsx(Pt,{onRecordingComplete:y})]}),o==="text"&&r.jsx(V,{fullWidth:!0,multiline:!0,rows:6,label:"Write your memory",name:"content",value:t.content,onChange:d,placeholder:"Share your thoughts, stories, or memories here..."})]})]})})}),r.jsx(Oe,{open:m.open,autoHideDuration:4e3,onClose:j,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:r.jsx(Y,{onClose:j,severity:m.severity,sx:{width:"100%"},children:m.message})})]})},wt=ae(r.jsx("path",{d:"M6 6h12v12H6z"})),Pt=({onRecordingComplete:t})=>{const[e,o]=n.useState(!1),[a,s]=n.useState(0),[p,x]=n.useState(null),[u,m]=n.useState(!1),[h,d]=n.useState(0),[i,b]=n.useState(0),v=n.useRef(null),g=n.useRef([]),y=n.useRef(null),L=n.useRef(new Audio),l=n.useRef(null);n.useEffect(()=>()=>{clearInterval(y.current),clearInterval(l.current),p&&URL.revokeObjectURL(p)},[p]),n.useEffect(()=>{p&&(L.current.src=p,L.current.onloadedmetadata=()=>{b(L.current.duration)},L.current.onended=()=>{m(!1),d(0),clearInterval(l.current)})},[p]);const j=async()=>{try{const S=await navigator.mediaDevices.getUserMedia({audio:!0});v.current=new MediaRecorder(S),g.current=[],v.current.ondataavailable=C=>{C.data.size>0&&g.current.push(C.data)},v.current.onstop=()=>{const C=new Blob(g.current,{type:"audio/wav"}),N=URL.createObjectURL(C);x(N),t&&t(N)},v.current.start(),o(!0),s(0),y.current=setInterval(()=>{s(C=>C+1)},1e3)}catch(S){console.error("Error starting recording:",S)}},w=()=>{v.current&&e&&(v.current.stop(),clearInterval(y.current),o(!1),v.current.stream.getTracks().forEach(S=>S.stop()))},c=()=>{u?(L.current.pause(),clearInterval(l.current)):(L.current.play(),l.current=setInterval(()=>{d(L.current.currentTime)},100)),m(!u)},f=()=>{p&&URL.revokeObjectURL(p),x(null),d(0),b(0),m(!1),clearInterval(l.current)},I=S=>{const C=Math.floor(S/60),N=Math.floor(S%60);return`${C.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`},R=(S,C)=>{L.current&&(L.current.currentTime=C,d(C))};return r.jsx(ie,{elevation:2,sx:{p:3,borderRadius:2},children:p?r.jsxs(P,{children:[r.jsx(M,{variant:"h6",gutterBottom:!0,children:"Voice Memory"}),r.jsxs(P,{sx:{display:"flex",alignItems:"center",mb:2},children:[r.jsx(de,{color:"primary",onClick:c,sx:{mr:1},children:u?r.jsx(Be,{}):r.jsx(ze,{})}),r.jsxs(P,{sx:{flexGrow:1,display:"flex",alignItems:"center"},children:[r.jsx(M,{variant:"body2",sx:{minWidth:45},children:I(h)}),r.jsx(Fe,{value:h,max:i||100,onChange:R,"aria-label":"audio position",sx:{mx:2}}),r.jsx(M,{variant:"body2",sx:{minWidth:45},children:I(i)})]})]}),r.jsxs(he,{direction:"row",spacing:2,justifyContent:"center",sx:{mt:3},children:[r.jsx(F,{variant:"outlined",color:"error",startIcon:r.jsx(Ee,{}),onClick:f,children:"Delete"}),r.jsx(F,{variant:"outlined",color:"primary",startIcon:r.jsx(Q,{}),onClick:j,children:"Record New"})]})]}):r.jsxs(P,{sx:{textAlign:"center"},children:[r.jsx(Pe.div,{whileHover:{scale:1.05},whileTap:{scale:.95},initial:{scale:1},style:{display:"inline-block"},children:r.jsx(de,{color:e?"error":"primary",sx:{width:80,height:80,bgcolor:e?"error.light":"primary.light",color:"white","&:hover":{bgcolor:e?"error.main":"primary.main"},mb:2},onClick:e?w:j,children:e?r.jsx(wt,{fontSize:"large"}):r.jsx(Q,{fontSize:"large"})})}),r.jsx(M,{variant:"h6",gutterBottom:!0,children:e?"Recording in progress...":"Tap to Start Recording"}),e&&r.jsxs(P,{sx:{width:"100%",mt:2},children:[r.jsx(Ye,{color:"error",sx:{height:10,borderRadius:5}}),r.jsx(M,{variant:"body1",sx:{mt:1,fontWeight:"bold"},children:I(a)})]})]})})},It=({onPhotoSelected:t,defaultImage:e})=>{const[o,a]=n.useState(!1),[s,p]=n.useState(!1),[x,u]=n.useState(e?!0:null),[m,h]=n.useState(e||null),d=n.useRef(null);n.useEffect(()=>{e&&(h(e),u(!0))},[e]),n.useEffect(()=>{e&&(h(e),u(!0))},[e]);const i=()=>{d.current.click()},b=v=>{const g=v.target.files[0];g&&t(g)};return r.jsxs(P,{sx:{width:"100%",height:"200px",border:"2px dashed",borderColor:"primary.main",borderRadius:2,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:"pointer",position:"relative",overflow:"hidden",bgcolor:"background.paper"},onClick:i,children:[e?r.jsx("img",{src:e,alt:"Memory preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):r.jsxs(r.Fragment,{children:[r.jsx(We,{sx:{fontSize:48,color:"primary.main",mb:1}}),r.jsx(M,{variant:"body1",color:"textSecondary",children:"Click to upload a photo"}),r.jsx(M,{variant:"caption",color:"textSecondary",children:"Supports: JPG, PNG, GIF"})]}),r.jsx("input",{type:"file",ref:d,onChange:b,accept:"image/*",style:{display:"none"}})]})},Xt=()=>{const t=Ie(),{user:e}=Me(),{triggerRefresh:o}=ke(),[a,s]=n.useState(0),[p,x]=n.useState(!1),[u,m]=n.useState(""),[h,d]=n.useState([]),[i,b]=n.useState({title:"",description:"",content:"",date:new Date().toISOString().split("T")[0],type:"text",people:[],filter:"none",location:""});n.useEffect(()=>{(async()=>{try{const{data:{user:j}}=await $.auth.getUser();if(!j)return;let w=j.id;if((e==null?void 0:e.type)==="family"){const{data:R,error:S}=await $.from("family_members").select("patient_id").eq("id",j.id).single();if(S)throw S;w=R.patient_id}const{data:c,error:f}=await $.from("memories").select("location").eq("user_id",w).not("location","is",null).not("location","eq","").order("created_at",{ascending:!1}).limit(10);if(f)throw f;const I=[...new Set(c.map(R=>R.location))];d(I)}catch(j){console.error("Error fetching recent locations:",j.message)}})()},[e]);const v=l=>{b(j=>({...j,location:l}))},g=["Create Memory","Add Details","Review & Save"],y=async()=>{if(a===g.length-1)try{const{data:{user:l},error:j}=await $.auth.getUser();if(j||!l)throw new Error("User not authenticated! Please log in.");let w=l.id;if((e==null?void 0:e.type)==="family"){const{data:f,error:I}=await $.from("family_members").select("patient_id").eq("id",l.id).single();if(I||!f)throw new Error("Could not find connected patient");w=f.patient_id}const{error:c}=await $.from("memories").insert([{user_id:w,title:i.title,description:i.description,content:i.content,date:i.date,type:i.type,location:i.location,people:i.people,filter:i.filter}]);if(c)throw c;o(),x(!0),setTimeout(()=>{(e==null?void 0:e.type)==="family"?t("/family/dashboard"):t("/patient/dashboard")},2e3)}catch(l){m(l.message)}else s(l=>l+1)},L=()=>{a===0?t(-1):s(l=>l-1)};return r.jsx(qe,{maxWidth:"md",sx:{mt:2,mb:4},children:r.jsxs(P,{sx:{width:"100%"},children:[r.jsxs(P,{sx:{display:"flex",alignItems:"center",mb:4},children:[r.jsx(F,{startIcon:r.jsx($e,{}),onClick:L,sx:{mr:2},children:"Back"}),r.jsx(M,{variant:"h4",children:"Add New Memory"})]}),r.jsx(ie,{elevation:2,sx:{p:3,borderRadius:3},children:p?r.jsx(Y,{severity:"success",children:"Memory saved successfully! Redirecting..."}):r.jsxs(r.Fragment,{children:[r.jsx(Lt,{activeStep:a,sx:{mb:4},children:g.map(l=>r.jsx(rt,{children:r.jsx(ve,{children:l})},l))}),u&&r.jsx(Y,{severity:"error",sx:{mb:3},children:u}),a===1&&h.length>0&&r.jsxs(P,{sx:{mb:3},children:[r.jsxs(M,{variant:"subtitle1",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(xe,{color:"primary"}),"Recent Locations"]}),r.jsx(he,{direction:"row",spacing:1,flexWrap:"wrap",gap:1,children:h.map((l,j)=>r.jsx(be,{label:l,onClick:()=>v(l),color:i.location===l?"primary":"default",variant:i.location===l?"filled":"outlined"},j))})]}),r.jsx(Rt,{memoryData:i,setMemoryData:b}),r.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",mt:4},children:[r.jsx(F,{variant:"outlined",onClick:L,sx:{borderRadius:2},children:"Back"}),r.jsx(F,{variant:"contained",color:"primary",onClick:y,sx:{borderRadius:2},children:a===g.length-1?"Save Memory":"Next"})]})]})})]})})};export{Xt as default};
